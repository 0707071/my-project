{% extends "base.html" %}

{% block title %}Search Results{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Search Results</h1>
            <div>
                <a href="{{ url_for('main.export_results', task_id=task.id) }}" 
                   class="btn btn-success">Export to CSV</a>
            </div>
        </div>

        {% if results.items %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>URL</th>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Domain</th>
                        {% if task.prompt %}
                            {% for field in task.prompt.fields %}
                                <th>{{ field.name }}</th>
                            {% endfor %}
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for result in results.items %}
                    <tr>
                        <td><a href="{{ result.url }}" target="_blank">{{ result.url }}</a></td>
                        <td>{{ result.title }}</td>
                        <td>{{ result.published_date.strftime('%d.%m.%Y') if result.published_date }}</td>
                        <td>{{ result.domain }}</td>
                        {% if task.prompt %}
                            {% set parsed = result.parse_analysis() %}
                            {% for field in task.prompt.fields %}
                                <td>{{ parsed.get(field.name, '') }}</td>
                            {% endfor %}
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {{ render_pagination(results, 'main.task_results', task_id=task.id) }}
        {% else %}
        <p>No results found.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
