{% extends "base.html" %}

{% block title %}Task Status{% endblock %}

{% block head %}
{{ super() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<style>
    .progress { 
        height: 20px; 
        margin-bottom: 10px; 
    }
    .progress-bar { 
        transition: width 0.3s ease-in-out; 
    }
    .logs-container {
        height: 400px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 0.9rem;
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 4px;
    }
    .log-entry {
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #eee;
    }
    .log-entry .timestamp {
        color: #666;
        margin-right: 1rem;
    }
    .log-entry.search { color: #0dcaf0; }
    .log-entry.clean { color: #ffc107; }
    .log-entry.analyze { color: #198754; }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h2>Task Progress</h2>
    
    <div class="progress mb-3">
        <div class="progress-bar" role="progressbar" 
             aria-valuenow="{{ task.progress }}"
             aria-valuemin="0" 
             aria-valuemax="100"
             style="width: {{ task.progress }}%">
            {{ task.progress }}%
        </div>
    </div>
    
    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Status: {{ task.status }}</h5>
            <p class="card-text">Stage: {{ task.stage }}</p>
            {% if task.error_message %}
            <div class="alert alert-danger">{{ task.error_message }}</div>
            {% endif %}
        </div>
    </div>
    
    {% if task.status == 'completed' %}
    <a href="{{ url_for('main.task_results', task_id=task.id) }}" class="btn btn-primary">
        View Results
    </a>
    {% else %}
    <div class="alert alert-info">
        Task is still running. This page will refresh automatically.
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    (function() {
        {% if task.status not in ['completed', 'failed'] %}
        // Обновляем страницу каждые 5 секунд если задача не завершена
        setTimeout(function() {
            window.location.reload();
        }, 5000);
        {% endif %}
    })();
</script>
{% endblock %}
