<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Karhuno Documentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8/styles/github.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Karhuno Documentation</h1>
    </header>

    <div class="container">
        <nav class="sidebar">
            {% for section in nav %}
            <div class="section">
                <button class="section-header collapsible">{{ section.title }}</button>
                <div class="section-content">
                    {% for file in section.files %}
                    <button class="file-header collapsible">{{ file.title }}</button>
                    <div class="file-content">
                        <a href="#{{ file.path | replace('/', '-') | replace('.md', '') }}">View content</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </nav>

        <main>
            {% for section in sections %}
            <section id="{{ section.name }}">
                <h2>{{ section.title }}</h2>
                {% for file in section.files %}
                <article id="{{ file.id }}">
                    {{ file.content }}
                </article>
                {% endfor %}
            </section>
            {% endfor %}
        </main>

        <aside class="toc">
            <!-- Table of contents will be generated here -->
        </aside>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((el) => {
                hljs.highlightElement(el);
            });
        });

        document.querySelectorAll('.collapsible').forEach(button => {
            button.addEventListener('click', function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        });

        function updateTOC() {
            const main = document.querySelector('main');
            const toc = document.querySelector('.toc');
            const headings = main.querySelectorAll('h2, h3, h4');
            
            const tocList = document.createElement('ul');
            headings.forEach(heading => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.textContent = heading.textContent;
                a.href = `#${heading.id}`;
                li.appendChild(a);
                tocList.appendChild(li);
            });
            
            toc.innerHTML = '';
            toc.appendChild(tocList);
        }

        window.addEventListener('scroll', updateTOC);
        updateTOC();
    </script>
</body>
</html>
