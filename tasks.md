# Техническое задание: Веб-интерфейс для системы поиска и анализа данных

## 1. Общие положения

### 1.1 Назначение системы
Веб-интерфейс предназначен для управления процессами поиска и анализа данных без необходимости работы через командную строку. Система должна обеспечить удобный доступ к функционалу существующих скриптов для пользователей без технических навыков.

### 1.2 Цели создания системы
- Упрощение работы аналитиков с существующими скриптами
- Обеспечение версионности промптов и поисковых запросов
- Возможность параллельной работы с несколькими кейсами
- Отслеживание процесса выполнения задач
- Управление настройками поиска через графический интерфейс

### 1.3 Технологический стек
- Backend: Flask
- Frontend: Bootstrap 5
- Аналитика: Dash
- База данных: SQLite (для MVP)
- Аутентификация: Flask-Login
- Асинхронные задачи: Celery + Redis

## 2. Архитектура системы

### 2.1 Структура проекта

web_interface/
├── app/
│ ├── init.py
│ ├── auth/
│ │ └── routes.py
│ ├── main/
│ │ └── routes.py
│ ├── models/
│ │ ├── client.py
│ │ ├── prompt.py
│ │ ├── search_query.py
│ │ └── user.py
│ ├── tasks/
│ │ └── search_tasks.py
│ └── templates/
│ ├── auth/
│ ├── main/
│ └── base.html
├── config.py
└── run.py

### 2.2 Интеграция с существующими модулями

#### Ключевые модули для интеграции:
- fetch_data.py: 
  - fetch_xmlstock_search_results()
  - fetch_and_save_articles()
- analyse_data.py:
  - analyse_data()
  - run_analyse_data()
- utils.py:
  - load_config()
  - clean_domain()

## 3. Функциональные требования

### 3.1 Аутентификация
- Регистрация пользователей только администратором
- Авторизация по логину/паролю
- Хранение сессий

### 3.2 Управление клиентами
- Создание нового клиента (бизнес-кейса)
- Просмотр списка клиентов
- Редактирование информации о клиенте
- Архивирование клиента

### 3.3 Управление поисковыми запросами
- Создание новых поисковых запросов
- Версионирование запросов
- Добавление/редактирование:
  - Основных поисковых фраз (построчно)
  - Include слов (построчно)
  - Exclude слов (построчно)
- Сохранение заметок к версиям
- Возможность копирования существующей версии
- Выбор активной версии для поиска

### 3.4 Управление промптами
- Создание новых промптов
- Версионирование промптов
- Добавление заметок к версиям
- Выбор активной версии для анализа
- История использования с результатами

### 3.5 Настройки поиска
- Количество дней для поиска
- Количество результатов
- Количество страниц
- Сохранение пресетов настроек

### 3.6 Управление задачами
- Запуск поиска с выбранными настройками
- Отображение статуса выполнения
- Просмотр логов в реальном времени
- Возможность остановки задачи
- История выполненных задач

### 3.7 Результаты
- Просмотр результатов в табличном виде
- Базовая фильтрация и сортировка
- Экспорт в Excel/CSV
- Доступ к архиву результатов

## 4. Нефункциональные требования

### 4.1 Производительность
- Время отклика интерфейса < 1 секунды
- Асинхронное выполнение задач
- Кэширование результатов

### 4.2 Безопасность
- Защита от несанкционированного доступа
- Логирование действий пользователей
- Бэкап данных

### 4.3 Масштабируемость
- Модульная архитектура
- Возможность добавления новых функций
- Поддержка локализации

## 5. Интерфейс пользователя

### 5.1 Общая структура
- Верхнее меню:
  - Клиенты
  - Поиск
  - Результаты
  - Настройки
- Боковая панель (контекстная)
- Основная область контента

### 5.2 Страница клиента
- Информация о клиенте
- Вкладки:
  - Поисковые запросы
  - Промпты
  - История поисков
  - Результаты

### 5.3 Страница поиска
- Выбор клиента
- Выбор версий запросов и промптов
- Настройки поиска
- Кнопки управления
- Область логов

## 6. Этапы разработки

### 6.1 Этап 1 - MVP
- Базовая структура проекта
- Аутентификация
- Управление клиентами
- Базовый функционал поисковых запросов
- Запуск поиска
- Просмотр результатов

### 6.2 Этап 2
- Версионирование промптов и запросов
- Система заметок
- Улучшенное отображение результатов
- Экспорт данных

### 6.3 Этап 3
- Dash-интеграция для аналитики
- Расширенные настройки
- Улучшение UI/UX
- Оптимизация производительности

## 7. Интеграционные требования

### 7.1 Форматы данных
- Поисковые запросы: JSON
- Промпты: TEXT
- Результаты: CSV/Excel
- Логи: TEXT

### 7.2 API
- REST API для всех операций
- WebSocket для real-time логов
- Celery для асинхронных задач

## 8. Тестирование

### 8.1 Виды тестирования
- Модульное тестирование
- Интеграционное тестирование
- UI тестирование
- Нагрузочное тестирование

### 8.2 Критерии приемки
- Успешное выполнение всех основных сценариев
- Время отклика в пределах нормы
- Корректная обработка ошибок
- Соответствие требованиям безопасности