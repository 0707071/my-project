<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Karhuno Documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Karhuno Documentation</h1>
    </header>

    <div class="container">
        <nav>
            
            <div class="section-group">
                <button class="section-toggle">Overview</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">Introduction</button>
                        <div class="file-content">
                            <a href="#overview-introduction">Introduction</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">System Architecture</button>
                        <div class="file-content">
                            <a href="#overview-architecture">System Architecture</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Data Pipeline</button>
                        <div class="file-content">
                            <a href="#overview-data-pipeline">Data Pipeline</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">Getting Started</button>
                <div class="section-content">
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">Business Processes</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">Business Processes</button>
                        <div class="file-content">
                            <a href="#business-processes-index">Business Processes</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Client Workflow</button>
                        <div class="file-content">
                            <a href="#business-processes-client-workflow">Client Workflow</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Analysis Process</button>
                        <div class="file-content">
                            <a href="#business-processes-analysis-process">Analysis Process</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Search Configuration</button>
                        <div class="file-content">
                            <a href="#business-processes-search-config">Search Configuration</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">Prompts</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">Prompts Overview</button>
                        <div class="file-content">
                            <a href="#prompts-index">Prompts Overview</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Prompt Structure Guide</button>
                        <div class="file-content">
                            <a href="#prompts-structure">Prompt Structure Guide</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Analysis Results Structure</button>
                        <div class="file-content">
                            <a href="#prompts-results">Analysis Results Structure</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">API Reference</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">API Overview</button>
                        <div class="file-content">
                            <a href="#api-overview">API Overview</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">API Authentication</button>
                        <div class="file-content">
                            <a href="#api-authentication">API Authentication</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">API Endpoints</button>
                        <div class="file-content">
                            <a href="#api-endpoints">API Endpoints</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">API Examples</button>
                        <div class="file-content">
                            <a href="#api-examples">API Examples</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">Deployment</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">System Setup</button>
                        <div class="file-content">
                            <a href="#deployment-setup">System Setup</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Configuration Guide</button>
                        <div class="file-content">
                            <a href="#deployment-configuration">Configuration Guide</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Security Setup</button>
                        <div class="file-content">
                            <a href="#deployment-security">Security Setup</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Monitoring Setup</button>
                        <div class="file-content">
                            <a href="#deployment-monitoring">Monitoring Setup</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">Performance</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">Performance Metrics</button>
                        <div class="file-content">
                            <a href="#performance-metrics">Performance Metrics</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Performance Optimization</button>
                        <div class="file-content">
                            <a href="#performance-optimization">Performance Optimization</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">System Scaling</button>
                        <div class="file-content">
                            <a href="#performance-scaling">System Scaling</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
            <div class="section-group">
                <button class="section-toggle">Troubleshooting</button>
                <div class="section-content">
                    
                    <div class="file-group">
                        <button class="file-toggle">Common Issues</button>
                        <div class="file-content">
                            <a href="#troubleshooting-common-issues">Common Issues</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Specific Cases</button>
                        <div class="file-content">
                            <a href="#troubleshooting-specific-cases">Specific Cases</a>
                        </div>
                    </div>
                    
                    <div class="file-group">
                        <button class="file-toggle">Support</button>
                        <div class="file-content">
                            <a href="#troubleshooting-support">Support</a>
                        </div>
                    </div>
                    
                </div>
            </div>
            
        </nav>

        <main>
            
            <section id="overview">
                <h2>Overview</h2>
                
                <article id="overview-introduction">
                    <h1 id="introduction">Introduction</h1>
<button class="collapsible">System Philosophy</button><div class="content"><p>Karhuno Analysis System was designed with a fundamental understanding: in modern business, opportunities are often visible through digital footprints before they become obvious. The system bridges the gap between vast amounts of unstructured data and actionable business intelligence.</p><h3 id="why-signal-intelligence">Why Signal Intelligence?</h3><p>Traditional lead generation often relies on static data or broad targeting. Signal Intelligence takes a different approach:
- Instead of "who might need our product?", we ask "who is showing signs of needing it right now?"
- Rather than mass outreach, we enable precise timing
- Focus on actual business events rather than assumed needs</p><p>For example:
- A company announcing office relocation is more likely to need office design services
- A business implementing solar panels signals interest in energy efficiency solutions
- New hiring patterns can indicate expansion or technological transformation</p></div>




<button class="collapsible">System Purpose</button><div class="content"><p>Karhuno automates the process of discovering and analyzing these business signals from open data sources. This automation is critical because:</p><ul>
<li><strong>Scale</strong>: Manual monitoring of multiple sources is impossible</li>
<li>A typical search covers 50+ queries across multiple sources</li>
<li>Each query can return hundreds of results</li>
<li>
<p>Processing this volume manually would take days</p>
</li>
<li>
<p><strong>Speed</strong>: Opportunities have limited time windows</p>
</li>
<li>Manual processing might take 2-3 days</li>
<li>Automated processing reduces this to 2-3 hours</li>
<li>
<p><a href="../performance/metrics.md">See Performance Metrics</a></p>
</li>
<li>
<p><strong>Consistency</strong>: Human analysis varies</p>
</li>
<li>Automated analysis ensures consistent criteria</li>
<li>Reduces missed opportunities</li>
<li>Enables objective comparison</li>
</ul></div>


<button class="collapsible">Key Components</button><div class="content"><h3 id="1-data-collection">1. Data Collection</h3><ul>
<li><strong>XMLSTOCK Integration</strong>: Aggregates search results from multiple engines</li>
<li>Why XMLSTOCK? <a href="architecture.md#xmlstock-choice">See Architecture Decisions</a></li>
<li>How it scales: <a href="../performance/scaling.md">Performance Details</a></li>
</ul><h3 id="2-analysis-pipeline">2. Analysis Pipeline</h3><ul>
<li><strong>LLM Processing</strong>: Intelligent signal analysis</li>
<li>Current setup: GPT-4o-mini as primary model</li>
<li>Fallback options: <a href="../prompts/llm.md">LLM Configuration</a></li>
<li>Processing strategies: <a href="data-pipeline.md">Analysis Pipeline</a></li>
</ul><h3 id="3-task-management">3. Task Management</h3><ul>
<li><strong>Asynchronous Processing</strong>: Long-running tasks management</li>
<li>Why Celery? <a href="architecture.md#task-queue">Architecture Decisions</a></li>
<li>How it works: <a href="../developer/core-functionality.md#task-system">Task System</a></li>
</ul></div>






<button class="collapsible">Target Audience</button><div class="content"><h3 id="primary-users">Primary Users</h3><ol>
<li><strong>Sales Teams</strong></li>
<li>Finding qualified leads through business signals</li>
<li>Timing outreach based on events</li>
<li>
<p><a href="../guides/sales-teams.md">See Sales Team Guide</a></p>
</li>
<li>
<p><strong>Market Researchers</strong></p>
</li>
<li>Tracking industry trends</li>
<li>Monitoring competitor activities</li>
<li>
<p><a href="../guides/researchers.md">See Research Guide</a></p>
</li>
<li>
<p><strong>Business Analysts</strong></p>
</li>
<li>Validating business hypotheses</li>
<li>Identifying market opportunities</li>
<li><a href="../guides/analysts.md">See Analysis Guide</a></li>
</ol><h3 id="system-users">System Users</h3><ol>
<li><strong>Analysts</strong></li>
<li>Creating and optimizing prompts</li>
<li>Validating results</li>
<li>
<p><a href="../business-processes/analysis-process.md">See Analyst Workflow</a></p>
</li>
<li>
<p><strong>Developers</strong></p>
</li>
<li>Extending system functionality</li>
<li>Integrating new data sources</li>
<li><a href="../developer/getting-started.md">See Developer Guide</a></li>
</ol></div>




<button class="collapsible">Getting Started</button><div class="content"><ul>
<li>For new developers: <a href="../developer/getting-started.md">Development Setup</a></li>
<li>For analysts: <a href="../guides/analyst-onboarding.md">Analyst Onboarding</a></li>
<li>For system overview: <a href="architecture.md">Architecture</a></li>
</ul></div>

<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="architecture.md">System Architecture</a></li>
<li><a href="data-pipeline.md">Data Pipeline</a></li>
<li><a href="../business-processes/index.md">Business Processes</a></li>
</ul></div>

                </article>
                
                <article id="overview-architecture">
                    <h1 id="system-architecture">System Architecture</h1>
<button class="collapsible">Design Philosophy</button><div class="content"><p>The architecture of Karhuno is built around three core principles:</p><ol>
<li><strong>Reliability</strong>: Tasks can take hours to complete</li>
<li>System must handle long-running processes</li>
<li>Network issues shouldn't fail entire tasks</li>
<li>
<p>Results must be preserved even if browser closes</p>
</li>
<li>
<p><strong>Scalability</strong>: Data volume grows with each client</p>
</li>
<li>Each client adds 20-50 search queries</li>
<li>Each query generates 100-500 results</li>
<li>
<p>Analysis requires significant processing power</p>
</li>
<li>
<p><strong>Maintainability</strong>: System constantly evolves</p>
</li>
<li>New data sources are regularly added</li>
<li>LLM models and prompts are updated</li>
<li>Client requirements change frequently</li>
</ol></div>


<button class="collapsible">High-Level Overview</button><div class="content"><p>System Flow:</p><div class="codehilite"><pre><span></span><code>Web Interface -&gt; Task Manager -&gt; Search Module -&gt; Data Storage
                            -&gt; Analysis Module -&gt; Data Storage
Search Module -&gt; External APIs
Analysis Module -&gt; LLM Services
</code></pre></div><h3 id="why-this-structure">Why This Structure?</h3><p>Each component is isolated to allow:
- Independent scaling
- Easier maintenance
- Parallel development
- Flexible deployment</p></div>




<button class="collapsible">Core Components</button><div class="content"><h3 id="1-web-interface-flask">1. Web Interface (Flask)</h3><p>Selected for:
- Quick MVP development
- Easy integration with Python ecosystem
- Lightweight resource usage
- Extensive middleware support</p><p>Key features:
- Client and case management
- Search query configuration
- Prompt management
- Task monitoring
- Results visualization</p><p><a href="../developer/web-interface.md">See Web Interface Details</a></p><h3 id="2-task-manager-celery">2. Task Manager (Celery)</h3><p>Critical for handling long-running processes:
- Tasks can run for hours
- Browser sessions may end
- Network interruptions are common
- Resource management is crucial</p><p>Features:
- Asynchronous task execution
- Automatic retries
- Progress tracking
- Resource monitoring</p><p><a href="../developer/task-management.md">See Task Management Guide</a></p><h3 id="3-search-module">3. Search Module</h3><p>Handles data collection and preprocessing:
- XMLSTOCK API integration
- Result deduplication
- Content extraction
- Initial filtering</p><p><a href="../developer/search-module.md">See Search Module Documentation</a></p><h3 id="4-analysis-module">4. Analysis Module</h3><p>Manages intelligent data processing:
- LLM integration
- Prompt handling
- Result classification
- Quality validation</p><p><a href="../developer/analysis-module.md">See Analysis Module Guide</a></p></div>














<button class="collapsible">Integration Points</button><div class="content"><h3 id="external-services">External Services</h3><h4 id="xmlstock-api">XMLSTOCK API</h4><p>Why XMLSTOCK?
- Aggregates multiple search engines
- Handles rate limiting
- Provides consistent API
- Manages search engine updates</p><p><a href="../integrations/xmlstock.md">See XMLSTOCK Integration Guide</a></p><h4 id="llm-services">LLM Services</h4><p>Current setup:
- Primary: GPT-4o-mini
  - Best balance of speed/quality
  - Cost-effective for high volume
- Fallbacks:
  - Claude-2 for complex analysis
  - GPT-4 for edge cases</p><p><a href="../integrations/llm.md">See LLM Integration Guide</a></p></div>







<button class="collapsible">Data Flow</button><div class="content"><h3 id="1-search-process">1. Search Process</h3></div>

                </article>
                
                <article id="overview-data-pipeline">
                    <h1 id="data-pipeline">Data Pipeline</h1>
<button class="collapsible">Pipeline Overview</button><div class="content"><p>The data pipeline in Karhuno is designed to handle large-scale data processing efficiently. A typical pipeline processes thousands of search results per task, requiring careful optimization at each stage.</p><h3 id="why-pipeline-architecture">Why Pipeline Architecture?</h3><ul>
<li><strong>Isolation</strong>: Each stage can fail and retry independently</li>
<li><strong>Scalability</strong>: Different stages can scale based on their needs</li>
<li><strong>Monitoring</strong>: Clear metrics for each processing step</li>
<li><strong>Optimization</strong>: Easy to identify and fix bottlenecks</li>
</ul></div>



<button class="collapsible">Pipeline Stages</button><div class="content"><p>Main Pipeline:
Search -&gt; Clean -&gt; Analyze -&gt; Format -&gt; Export</p><h3 id="1-search-stage">1. Search Stage</h3><p>Collects raw data from various sources.</p><h4 id="process-flow">Process Flow</h4><div class="codehilite"><pre><span></span><code><span class="c1"># Example search configuration</span>
<span class="n">search_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'queries'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'office relocation'</span><span class="p">,</span> <span class="s1">'new office'</span><span class="p">],</span>
    <span class="s1">'date_range'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>  <span class="c1"># days</span>
    <span class="s1">'results_per_query'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">'sources'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'news'</span><span class="p">,</span> <span class="s1">'press-releases'</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>Key Considerations:
- <strong>Rate Limiting</strong>: Respect API limits
  - Implement exponential backoff
  - Use multiple API keys
  - <a href="../developer/api-management.md">See Rate Management</a></p><ul>
<li><strong>Parallel Processing</strong>: Optimize data collection</li>
<li>Multiple queries in parallel</li>
<li>Batch requests where possible</li>
<li><a href="../performance/search-optimization.md">See Search Optimization</a></li>
</ul><h3 id="2-clean-stage">2. Clean Stage</h3><p>Prepares raw data for analysis.</p><h4 id="process-flow_1">Process Flow</h4><div class="codehilite"><pre><span></span><code><span class="c1"># Example cleaning pipeline</span>
<span class="n">cleaning_steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">remove_html_tags</span><span class="p">(),</span>
    <span class="n">normalize_whitespace</span><span class="p">(),</span>
    <span class="n">remove_duplicates</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.85</span><span class="p">),</span>
    <span class="n">validate_content</span><span class="p">()</span>
<span class="p">]</span>
</code></pre></div><p>Key Features:
- <strong>Deduplication</strong>: Remove similar content
  - Text similarity algorithms
  - URL matching
  - Content fingerprinting
  - <a href="../developer/deduplication.md">See Deduplication Guide</a></p><ul>
<li><strong>Content Extraction</strong>: Clean HTML and formatting</li>
<li>Preserve important structure</li>
<li>Remove ads and boilerplate</li>
<li>Extract main content</li>
<li><a href="../developer/content-extraction.md">See Content Extraction</a></li>
</ul><h3 id="3-analyze-stage">3. Analyze Stage</h3><p>Processes cleaned data through LLM.</p><h4 id="process-flow_2">Process Flow</h4><div class="codehilite"><pre><span></span><code><span class="c1"># Example analysis configuration</span>
<span class="n">analysis_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'batch_size'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>  <span class="c1"># items per batch</span>
    <span class="s1">'max_retries'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">'timeout'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>  <span class="c1"># seconds</span>
    <span class="s1">'fallback_models'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'gpt-4'</span><span class="p">,</span> <span class="s1">'claude-2'</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div><p>Optimization Strategies:
- <strong>Batch Processing</strong>: Optimize LLM usage
  - Group similar items
  - Balance batch size
  - Handle partial failures
  - <a href="../developer/batch-processing.md">See Batch Processing</a></p><ul>
<li><strong>Error Handling</strong>: Ensure reliability</li>
<li>Automatic retries</li>
<li>Model fallbacks</li>
<li>Result validation</li>
<li><a href="../developer/error-handling.md">See Error Handling</a></li>
</ul><h3 id="4-format-stage">4. Format Stage</h3><p>Structures analysis results.</p><h4 id="process-flow_3">Process Flow</h4><div class="codehilite"><pre><span></span><code><span class="c1"># Example output format</span>
<span class="n">result_format</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'signal_type'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">'confidence'</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s1">'extracted_data'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'company'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'event'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'timeline'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'scale'</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">},</span>
    <span class="s1">'metadata'</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">}</span>
</code></pre></div><p>Key Features:
- <strong>Data Validation</strong>: Ensure quality
  - Schema validation
  - Type checking
  - Required fields
  - <a href="../developer/validation.md">See Data Validation</a></p><ul>
<li><strong>Enrichment</strong>: Add context</li>
<li>Company information</li>
<li>Geographic data</li>
<li>Industry classification</li>
<li><a href="../developer/enrichment.md">See Data Enrichment</a></li>
</ul><h3 id="5-export-stage">5. Export Stage</h3><p>Delivers processed results.</p><h4 id="process-flow_4">Process Flow</h4><div class="codehilite"><pre><span></span><code><span class="c1"># Example export configuration</span>
<span class="n">export_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'formats'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'database'</span><span class="p">,</span> <span class="s1">'excel'</span><span class="p">,</span> <span class="s1">'api'</span><span class="p">],</span>
    <span class="s1">'notification'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'email'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'webhook'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'archival'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'retention_days'</span><span class="p">:</span> <span class="mi">30</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Features:
- <strong>Multiple Formats</strong>: Support various outputs
  - Database storage
  - File exports
  - API responses
  - <a href="../developer/export-formats.md">See Export Formats</a></p><ul>
<li><strong>Notification System</strong>: Keep users informed</li>
<li>Email notifications</li>
<li>Webhook integration</li>
<li>Status updates</li>
<li><a href="../developer/notifications.md">See Notifications</a></li>
</ul></div>































<button class="collapsible">Pipeline Variations</button><div class="content"><h3 id="job-search-pipeline">Job Search Pipeline:</h3><p>Job Sites -&gt; Parse Listings -&gt; Extract Details -&gt; Analyze Signals -&gt; Format Results</p><p><a href="../pipelines/job-search.md">See Job Search Guide</a></p><h3 id="company-analysis-pipeline">Company Analysis Pipeline</h3><p>For detailed company research:</p><p>Company Analysis Pipeline:
Company List -&gt; Fetch Data -&gt; Enrich -&gt; Analyze -&gt; Score &amp; Rank</p><p><a href="../pipelines/company-analysis.md">See Company Analysis Guide</a></p></div>







<button class="collapsible">Performance Optimization</button><div class="content"><h3 id="memory-management">Memory Management</h3><ul>
<li>Streaming processing for large datasets
  <code>python
  # Example of streaming processing
  async for batch in stream_results(query):
      processed = await process_batch(batch)
      await store_results(processed)</code></li>
<li>Automatic cleanup of temporary data</li>
<li>Resource monitoring and limits</li>
<li><a href="../performance/memory.md">See Memory Management</a></li>
</ul><h3 id="processing-optimization">Processing Optimization</h3><ul>
<li>Parallel processing where possible
  <code>python
  # Example of parallel processing
  async with ProcessPoolExecutor() as executor:
      tasks = [process_item(item) for item in items]
      results = await asyncio.gather(*tasks)</code></li>
<li>Caching frequently used data</li>
<li>Load balancing across workers</li>
<li><a href="../performance/processing.md">See Processing Optimization</a></li>
</ul></div>




<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="../performance/tuning.md">Performance Tuning</a></li>
<li><a href="../troubleshooting/index.md">Error Handling</a></li>
<li><a href="../operations/monitoring.md">Monitoring</a></li>
<li><a href="../developer/pipeline-development.md">Pipeline Development</a></li>
</ul></div>

                </article>
                
            </section>
            
            <section id="getting-started">
                <h2>Getting Started</h2>
                
            </section>
            
            <section id="business-processes">
                <h2>Business Processes</h2>
                
                <article id="business-processes-index">
                    <h1 id="business-processes">Business Processes</h1>
<button class="collapsible">Overview</button><div class="content"><p>The Karhuno system combines automated data processing with expert analysis to deliver high-quality business signals. This section describes the core business processes and workflows.</p></div>

<button class="collapsible">Process Map</button><div class="content"><p>Core Components:</p><div class="codehilite"><pre><span></span><code>Data Collection -&gt; Processing Pipeline -&gt; Analysis Engine -&gt; Results Delivery
     |                   |                    |                  |
     v                   v                    v                  v
API Layer         Task Management      LLM Integration     Export System
</code></pre></div></div>


<button class="collapsible">Key Processes</button><div class="content"><h3 id="1-client-management">1. Client Management</h3><ul>
<li><a href="client-workflow.md">Client Workflow</a></li>
<li>Initial setup and configuration</li>
<li>Result delivery and feedback</li>
<li>Continuous improvement</li>
</ul><h3 id="2-search-process">2. Search Process</h3><ul>
<li><a href="search-config.md">Search Configuration</a></li>
<li>Query development</li>
<li>Source selection</li>
<li>Performance optimization</li>
</ul><h3 id="3-analysis-process">3. Analysis Process</h3><ul>
<li><a href="analysis-process.md">Analysis Process</a></li>
<li>Signal detection</li>
<li>Data enrichment</li>
<li>Quality control</li>
</ul></div>






<button class="collapsible">Role-Based Guides</button><div class="content"><h3 id="for-analysts">For Analysts</h3><div class="codehilite"><pre><span></span><code><span class="n">analyst_responsibilities</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'configuration'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Create and optimize search queries'</span><span class="p">,</span>
        <span class="s1">'Develop and refine prompts'</span><span class="p">,</span>
        <span class="s1">'Configure data sources'</span>
    <span class="p">],</span>
    <span class="s1">'analysis'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Review and score signals'</span><span class="p">,</span>
        <span class="s1">'Identify improvement patterns'</span><span class="p">,</span>
        <span class="s1">'Document insights'</span>
    <span class="p">],</span>
    <span class="s1">'client_management'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Select top signals'</span><span class="p">,</span>
        <span class="s1">'Prepare client reports'</span><span class="p">,</span>
        <span class="s1">'Process feedback'</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div><h3 id="for-developers">For Developers</h3><div class="codehilite"><pre><span></span><code><span class="n">developer_responsibilities</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'system_maintenance'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Monitor performance metrics'</span><span class="p">,</span>
        <span class="s1">'Optimize processing pipeline'</span><span class="p">,</span>
        <span class="s1">'Handle technical issues'</span>
    <span class="p">],</span>
    <span class="s1">'integration'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Implement new data sources'</span><span class="p">,</span>
        <span class="s1">'Update API integrations'</span><span class="p">,</span>
        <span class="s1">'Enhance processing modules'</span>
    <span class="p">],</span>
    <span class="s1">'support'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Assist with technical setup'</span><span class="p">,</span>
        <span class="s1">'Resolve system issues'</span><span class="p">,</span>
        <span class="s1">'Implement improvements'</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>




<button class="collapsible">Performance Metrics</button><div class="content"><h3 id="process-efficiency">Process Efficiency</h3><div class="codehilite"><pre><span></span><code><span class="n">efficiency_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'search_process'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'query_effectiveness'</span><span class="p">:</span> <span class="s1">'Relevant results / Total results'</span><span class="p">,</span>
        <span class="s1">'source_coverage'</span><span class="p">:</span> <span class="s1">'Active sources / Total sources'</span><span class="p">,</span>
        <span class="s1">'processing_time'</span><span class="p">:</span> <span class="s1">'Average time per batch'</span>
    <span class="p">},</span>
    <span class="s1">'analysis_process'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'signal_quality'</span><span class="p">:</span> <span class="s1">'High quality signals / Total signals'</span><span class="p">,</span>
        <span class="s1">'processing_accuracy'</span><span class="p">:</span> <span class="s1">'Correct classifications / Total'</span><span class="p">,</span>
        <span class="s1">'analyst_efficiency'</span><span class="p">:</span> <span class="s1">'Processed signals per hour'</span>
    <span class="p">},</span>
    <span class="s1">'delivery_process'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'client_satisfaction'</span><span class="p">:</span> <span class="s1">'Positive feedback ratio'</span><span class="p">,</span>
        <span class="s1">'delivery_timeliness'</span><span class="p">:</span> <span class="s1">'On-time delivery rate'</span><span class="p">,</span>
        <span class="s1">'signal_relevance'</span><span class="p">:</span> <span class="s1">'Used signals / Delivered signals'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="quality-metrics">Quality Metrics</h3><div class="codehilite"><pre><span></span><code><span class="n">quality_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'signal_quality'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'accuracy'</span><span class="p">:</span> <span class="s1">'Correct signals / Total signals'</span><span class="p">,</span>
        <span class="s1">'relevance'</span><span class="p">:</span> <span class="s1">'Relevant signals / Total signals'</span><span class="p">,</span>
        <span class="s1">'completeness'</span><span class="p">:</span> <span class="s1">'Complete data points / Required points'</span>
    <span class="p">},</span>
    <span class="s1">'system_performance'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'uptime'</span><span class="p">:</span> <span class="s1">'System availability percentage'</span><span class="p">,</span>
        <span class="s1">'response_time'</span><span class="p">:</span> <span class="s1">'Average processing time'</span><span class="p">,</span>
        <span class="s1">'error_rate'</span><span class="p">:</span> <span class="s1">'Errors / Total operations'</span>
    <span class="p">},</span>
    <span class="s1">'analyst_performance'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'review_accuracy'</span><span class="p">:</span> <span class="s1">'Correct reviews / Total reviews'</span><span class="p">,</span>
        <span class="s1">'processing_speed'</span><span class="p">:</span> <span class="s1">'Signals reviewed per hour'</span><span class="p">,</span>
        <span class="s1">'improvement_impact'</span><span class="p">:</span> <span class="s1">'Performance gain from updates'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>




<button class="collapsible">Best Practices</button><div class="content"><h3 id="process-optimization">Process Optimization</h3><ol>
<li><strong>Regular Review Cycles</strong></li>
<li>Weekly performance analysis</li>
<li>Monthly configuration updates</li>
<li>
<p>Quarterly system optimization</p>
</li>
<li>
<p><strong>Quality Control</strong></p>
</li>
<li>Systematic signal review</li>
<li>Pattern documentation</li>
<li>
<p>Continuous improvement</p>
</li>
<li>
<p><strong>Knowledge Management</strong></p>
</li>
<li>Document insights</li>
<li>Share best practices</li>
<li>Maintain configuration notes</li>
</ol></div>


<button class="collapsible">Related Documentation</button><div class="content"><ul>
<li><a href="../overview/architecture.md">System Architecture</a></li>
<li><a href="../developer/getting-started.md">Development Guide</a></li>
<li><a href="../performance/tuning.md">Performance Tuning</a></li>
<li><a href="../best-practices/quality-control.md">Quality Control</a></li>
</ul></div>

                </article>
                
                <article id="business-processes-client-workflow">
                    <h1 id="client-workflow">Client Workflow</h1>
<button class="collapsible">Overview</button><div class="content"><p>The client workflow consists of two main configuration components:
- Search queries for data collection
- Analysis prompts for signal detection</p><p>Each component can be saved as a preset and combined flexibly for different analysis tasks.</p></div>


<button class="collapsible">Workflow Stages</button><div class="content"><p>Client Process Flow:</p><div class="codehilite"><pre><span></span><code>Initial Setup -&gt; Search Config -&gt; Data Collection -&gt; Signal Analysis -&gt; Manual Review -&gt; Client Delivery
                             -&gt; Prompt Design                      -&gt; System Updates -&gt; Back to Config
</code></pre></div></div>


<button class="collapsible">Configuration Process</button><div class="content"><h3 id="1-search-setup">1. Search Setup</h3><p>Create and manage search queries:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SearchConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages search query configurations.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Query management</span>
<span class="sd">    2. Source selection</span>
<span class="sd">    3. Performance tracking</span>
<span class="sd">    4. Notes and metadata</span>

<span class="sd">    Example usage:</span>
<span class="sd">        config = SearchConfiguration(client_id='client123')</span>
<span class="sd">        await config.save_preset('warehouse_tech')</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">save_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">notes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Save search configuration as preset.</span>

<span class="sd">        Stores:</span>
<span class="sd">        - Query patterns</span>
<span class="sd">        - Source settings</span>
<span class="sd">        - Performance metrics</span>
<span class="sd">        - Analyst notes</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'name'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">'queries'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">,</span>
            <span class="s1">'sources'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span>
            <span class="s1">'metrics'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metrics</span><span class="p">(),</span>
            <span class="s1">'notes'</span><span class="p">:</span> <span class="n">notes</span><span class="p">,</span>
            <span class="s1">'created_at'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-prompt-engineering">2. Prompt Engineering</h3><p>Design and optimize analysis prompts:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PromptConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages analysis prompt configurations.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Prompt templates</span>
<span class="sd">    2. Output columns</span>
<span class="sd">    3. Example management</span>
<span class="sd">    4. Performance tracking</span>

<span class="sd">    Example usage:</span>
<span class="sd">        config = PromptConfiguration(industry='warehouse_tech')</span>
<span class="sd">        await config.save_preset('motion_sensors')</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">save_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">notes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Save prompt configuration as preset.</span>

<span class="sd">        Stores:</span>
<span class="sd">        - Prompt template</span>
<span class="sd">        - Output format</span>
<span class="sd">        - Example cases</span>
<span class="sd">        - Performance data</span>
<span class="sd">        - Analyst notes</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'name'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">'template'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span>
            <span class="s1">'output_columns'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="s1">'examples'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">examples</span><span class="p">,</span>
            <span class="s1">'metrics'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metrics</span><span class="p">(),</span>
            <span class="s1">'notes'</span><span class="p">:</span> <span class="n">notes</span><span class="p">,</span>
            <span class="s1">'created_at'</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Analysis Workflow</button><div class="content"><h3 id="1-task-execution">1. Task Execution</h3><p>Combine search and analysis configurations:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AnalysisTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages analysis task execution.</span>

<span class="sd">    Process:</span>
<span class="sd">    1. Load configurations</span>
<span class="sd">    2. Execute search</span>
<span class="sd">    3. Apply analysis</span>
<span class="sd">    4. Filter results</span>

<span class="sd">    Example usage:</span>
<span class="sd">        task = AnalysisTask(</span>
<span class="sd">            search_preset='warehouse_tech',</span>
<span class="sd">            prompt_preset='motion_sensors'</span>
<span class="sd">        )</span>
<span class="sd">        results = await task.execute()</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Execute analysis task.</span>

<span class="sd">        Steps:</span>
<span class="sd">        1. Validate configurations</span>
<span class="sd">        2. Collect raw data</span>
<span class="sd">        3. Process signals</span>
<span class="sd">        4. Apply filters</span>
<span class="sd">        5. Generate report</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'raw_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_results</span><span class="p">,</span>
            <span class="s1">'processed_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processed_results</span><span class="p">,</span>
            <span class="s1">'filtered_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered_results</span><span class="p">,</span>
            <span class="s1">'top_signals'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_signals</span><span class="p">,</span>
            <span class="s1">'metrics'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_metrics</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-result-review">2. Result Review</h3><p>Manual validation and scoring:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ResultReview</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages manual result review process.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Signal scoring (1-5)</span>
<span class="sd">    2. Error pattern detection</span>
<span class="sd">    3. Improvement suggestions</span>
<span class="sd">    4. Performance tracking</span>

<span class="sd">    Example usage:</span>
<span class="sd">        review = ResultReview(task_id='task123')</span>
<span class="sd">        await review.complete_review()</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">complete_review</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Complete manual review process.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Score signals</span>
<span class="sd">        2. Identify patterns</span>
<span class="sd">        3. Generate insights</span>
<span class="sd">        4. Update metrics</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'reviewed_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reviewed_signals</span><span class="p">,</span>
            <span class="s1">'selected_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_signals</span><span class="p">,</span>
            <span class="s1">'error_patterns'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_patterns</span><span class="p">,</span>
            <span class="s1">'suggestions'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">improvement_suggestions</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">System Improvement</button><div class="content"><h3 id="1-performance-analysis">1. Performance Analysis</h3><p>Track and analyze system performance:</p><div class="codehilite"><pre><span></span><code><span class="n">performance_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'search_efficiency'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'query_performance'</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># Query-specific metrics</span>
        <span class="s1">'source_quality'</span><span class="p">:</span> <span class="p">{},</span>     <span class="c1"># Source-specific metrics</span>
        <span class="s1">'coverage_analysis'</span><span class="p">:</span> <span class="p">{}</span>   <span class="c1"># Coverage statistics</span>
    <span class="p">},</span>
    <span class="s1">'analysis_quality'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'prompt_effectiveness'</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># Prompt-specific metrics</span>
        <span class="s1">'signal_accuracy'</span><span class="p">:</span> <span class="p">{},</span>       <span class="c1"># Signal quality metrics</span>
        <span class="s1">'processing_efficiency'</span><span class="p">:</span> <span class="p">{}</span>  <span class="c1"># Processing statistics</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-continuous-improvement">2. Continuous Improvement</h3><p>Iterative system optimization:</p><div class="codehilite"><pre><span></span><code><span class="n">improvement_workflow</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'search_optimization'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Remove ineffective queries'</span><span class="p">,</span>
        <span class="s1">'Expand successful patterns'</span><span class="p">,</span>
        <span class="s1">'Adjust source weights'</span><span class="p">,</span>
        <span class="s1">'Update filtering rules'</span>
    <span class="p">],</span>
    <span class="s1">'prompt_optimization'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Refine signal definitions'</span><span class="p">,</span>
        <span class="s1">'Update example cases'</span><span class="p">,</span>
        <span class="s1">'Adjust scoring criteria'</span><span class="p">,</span>
        <span class="s1">'Enhance output format'</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Analyst Workflow</button><div class="content"><h3 id="initial-client-setup">Initial Client Setup</h3><ol>
<li>
<p><strong>Client Requirements Analysis</strong>
<code>python
   client_profile = {
       'industry': 'warehouse_technology',
       'target_markets': ['Nordics', 'Baltics'],
       'company_size': {
           'min_revenue': 'up to 100M',
           'max_revenue': 'up to 5000M'
       },
       'special_focus': [
           'cold storage facilities',
           'logistics centers',
           'manufacturing plants'
       ]
   }</code></p>
</li>
<li>
<p><strong>Search Strategy Development</strong>
<code>python
   search_strategy = {
       'primary_sources': [
           'industry_news',
           'company_announcements',
           'construction_permits'
       ],
       'signal_types': [
           'expansion_plans',
           'facility_upgrades',
           'energy_efficiency_initiatives'
       ],
       'update_frequency': '12h'
   }</code></p>
</li>
</ol><h3 id="iterative-optimization">Iterative Optimization</h3><ol>
<li>
<p><strong>Signal Quality Assessment</strong>
   ```python
   class SignalQualityAnalysis:
       """
       Analyzes signal quality and suggests improvements.</p>
<p>Process:
   1. Review top/bottom signals
   2. Identify patterns in false positives
   3. Document successful patterns
   4. Update configurations</p>
<p>Note: Document insights in notes field for future reference
   """</p>
<p>def analyze_batch(self, 
                    signals: List[Dict[str, Any]],
                    analyst_scores: Dict[int, int]) -&gt; Dict[str, Any]:
       """
       Analyze batch of signals with analyst scores.</p>
<div class="codehilite"><pre><span></span><code><span class="w">   </span><span class="n">Args</span><span class="p">:</span>
<span class="w">       </span><span class="n">signals</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">processed</span><span class="w"> </span><span class="n">signals</span>
<span class="w">       </span><span class="n">analyst_scores</span><span class="p">:</span><span class="w"> </span><span class="n">Manual</span><span class="w"> </span><span class="n">scores</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">signals</span>

<span class="w">   </span><span class="n">Returns</span><span class="p">:</span>
<span class="w">       </span><span class="n">Analysis</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">improvement</span><span class="w"> </span><span class="n">suggestions</span>
<span class="w">   </span><span class="s2">"""</span>
<span class="s2">   return {</span>
<span class="s2">       'high_quality_patterns': self._analyze_top_signals(signals, analyst_scores),</span>
<span class="s2">       'noise_patterns': self._analyze_low_quality(signals, analyst_scores),</span>
<span class="s2">       'suggested_updates': self._generate_suggestions(),</span>
<span class="s2">       'effectiveness_metrics': self._calculate_metrics()</span>
<span class="s2">   }</span>
</code></pre></div>
<p>```</p>
</li>
<li>
<p><strong>Configuration Refinement</strong>
   ```python
   class ConfigurationOptimizer:
       """
       Optimizes search and prompt configurations based on results.</p>
<p>Key aspects:
   1. Query effectiveness tracking
   2. Source quality monitoring
   3. Prompt performance analysis
   4. Cost-benefit analysis</p>
<p>Example:
       optimizer = ConfigurationOptimizer(client_id='client123')
       suggestions = await optimizer.analyze_performance()
   """</p>
<p>async def analyze_performance(self) -&gt; Dict[str, Any]:
       """
       Analyze configuration performance.</p>
<div class="codehilite"><pre><span></span><code>   Analysis includes:
   <span class="k">-</span> Query hit rates
   <span class="k">-</span> Source value metrics
   <span class="k">-</span> Processing efficiency
   <span class="k">-</span> Signal quality distribution
   """
   return {
       'query_metrics': self._analyze_queries(),
       'source_metrics': self._analyze_sources(),
       'prompt_metrics': self._analyze_prompts(),
       'optimization_suggestions': self._generate_suggestions()
   }
</code></pre></div>
<p>```</p>
</li>
</ol><h3 id="quality-control-process">Quality Control Process</h3><ol>
<li>
<p><strong>Manual Review Guidelines</strong>
<code>python
   review_guidelines = {
       'signal_scoring': {
           5: 'Perfect match, ready for client',
           4: 'Good signal, needs minor refinement',
           3: 'Potential signal, needs investigation',
           2: 'Weak signal, likely noise',
           1: 'Complete miss, update filters'
       },
       'review_steps': [
           'Verify company details',
           'Validate signal relevance',
           'Check revenue range',
           'Assess timing/urgency',
           'Evaluate action potential'
       ],
       'documentation': {
           'required_notes': [
               'Quality issues found',
               'Improvement suggestions',
               'Pattern observations'
           ]
       }
   }</code></p>
</li>
<li>
<p><strong>Continuous Learning</strong>
   ```python
   class LearningSystem:
       """
       Manages system learning from analyst feedback.</p>
<p>Features:
   1. Pattern recognition
   2. Error analysis
   3. Configuration updates
   4. Performance tracking</p>
<p>Note: Document all insights for team knowledge sharing
   """</p>
<p>async def process_feedback(self,
                            batch_results: Dict[str, Any],
                            analyst_feedback: Dict[str, Any]) -&gt; Dict[str, Any]:
       """
       Process analyst feedback and update system.</p>
<div class="codehilite"><pre><span></span><code>   Steps:
   1. Analyze feedback patterns
   2. Update configurations
   3. Track improvements
   4. Generate reports
   """
   return {
       'identified_patterns': self._analyze_patterns(),
       'suggested_updates': self._generate_updates(),
       'performance_impact': self._estimate_impact(),
       'learning_summary': self._generate_summary()
   }
</code></pre></div>
<p>```</p>
</li>
</ol><h3 id="client-delivery">Client Delivery</h3><ol>
<li>
<p><strong>Result Selection</strong>
   ```python
   class ResultSelector:
       """
       Manages final result selection for client delivery.</p>
<p>Process:
   1. Filter by score (typically 4-5)
   2. Remove duplicates
   3. Group by signal type
   4. Sort by relevance</p>
<p>Example:
       selector = ResultSelector(min_score=4)
       delivery = await selector.prepare_delivery()
   """</p>
<p>async def prepare_delivery(self) -&gt; Dict[str, Any]:
       """
       Prepare results for client delivery.</p>
<div class="codehilite"><pre><span></span><code><span class="w">   </span><span class="n">Steps</span><span class="p">:</span>
<span class="w">   </span><span class="mf">1.</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="n">selection</span><span class="w"> </span><span class="n">criteria</span>
<span class="w">   </span><span class="mf">2.</span><span class="w"> </span><span class="n">Format</span><span class="w"> </span><span class="n">results</span>
<span class="w">   </span><span class="mf">3.</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">insights</span>
<span class="w">   </span><span class="mf">4.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">summary</span>
<span class="w">   </span><span class="s2">"""</span>
<span class="s2">   return {</span>
<span class="s2">       'selected_signals': self._select_signals(),</span>
<span class="s2">       'signal_groups': self._group_signals(),</span>
<span class="s2">       'key_insights': self._generate_insights(),</span>
<span class="s2">       'delivery_summary': self._create_summary()</span>
<span class="s2">   }</span>
</code></pre></div>
<p>```</p>
</li>
</ol></div>








<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="search-config.md">Search Configuration</a></li>
<li><a href="analysis-process.md">Analysis Process</a></li>
<li><a href="../performance/metrics.md">Quality Metrics</a></li>
<li><a href="../best-practices/index.md">Best Practices</a></li>
<li><a href="../best-practices/quality-control.md">Quality Control</a></li>
<li><a href="../guides/analyst-workflow.md">Analyst Guidelines</a> </li>
</ul></div>

                </article>
                
                <article id="business-processes-analysis-process">
                    <h1 id="analysis-process">Analysis Process</h1>
<button class="collapsible">Overview</button><div class="content"><p>The analysis process transforms raw search results into actionable business signals. This is a critical stage where:
- Raw text is converted to structured data
- Business relevance is determined
- Signals are classified and scored
- Results are enriched with context</p></div>

<button class="collapsible">Process Stages</button><div class="content"><div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">LR</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Raw</span><span class="w"> </span><span class="n">Data</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Pre</span><span class="o">-</span><span class="n">processing</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">LLM</span><span class="w"> </span><span class="n">Analysis</span><span class="p">]</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Post</span><span class="o">-</span><span class="n">processing</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Validation</span><span class="p">]</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Enrichment</span><span class="p">]</span>

<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">f9f</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">bbf</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">bfb</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">fbb</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">fff</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">ffd</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span>
</code></pre></div><h3 id="1-pre-processing">1. Pre-processing</h3><p>Prepare data for analysis:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PreProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Prepares raw data for LLM analysis.</span>

<span class="sd">    Why this matters:</span>
<span class="sd">    - Clean data improves LLM accuracy</span>
<span class="sd">    - Structured input ensures consistent analysis</span>
<span class="sd">    - Proper formatting reduces token usage</span>

<span class="sd">    Example usage:</span>
<span class="sd">        processor = PreProcessor(config)</span>
<span class="sd">        clean_data = await processor.process(raw_data)</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Process raw data through cleaning pipeline.</span>

<span class="sd">        Steps:</span>
<span class="sd">        1. Text normalization</span>
<span class="sd">        2. Content extraction</span>
<span class="sd">        3. Format standardization</span>
<span class="sd">        4. Length optimization</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'text'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_text</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]),</span>
            <span class="s1">'metadata'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_metadata</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">'context'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_context</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-llm-analysis">2. LLM Analysis</h3><p>Core analysis using language models:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SignalAnalyzer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Analyzes text for business signals using LLM.</span>

<span class="sd">    Key features:</span>
<span class="sd">    1. Multi-stage analysis</span>
<span class="sd">    2. Context-aware processing</span>
<span class="sd">    3. Confidence scoring</span>
<span class="sd">    4. Signal classification</span>

<span class="sd">    Example:</span>
<span class="sd">        analyzer = SignalAnalyzer(model_config)</span>
<span class="sd">        signals = await analyzer.analyze(clean_data)</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                     <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                     <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Perform multi-stage signal analysis.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Initial signal detection</span>
<span class="sd">        2. Detailed analysis of potential signals</span>
<span class="sd">        3. Confidence scoring</span>
<span class="sd">        4. Classification</span>

<span class="sd">        Note: Each stage can retry independently on failure</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Stage 1: Signal Detection</span>
            <span class="n">potential_signals</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_signals</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'text'</span><span class="p">])</span>

            <span class="c1"># Stage 2: Detailed Analysis</span>
            <span class="n">analyzed_signals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">potential_signals</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">signal</span><span class="p">[</span><span class="s1">'confidence'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_confidence</span><span class="p">:</span>
                    <span class="n">detailed</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_signal</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                    <span class="n">analyzed_signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detailed</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">analyzed_signals</span>

        <span class="k">except</span> <span class="n">LLMError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle LLM-specific errors</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"LLM Analysis failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div><h3 id="3-post-processing">3. Post-processing</h3><p>Refine and structure analysis results:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PostProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Processes and structures LLM analysis results.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Result validation</span>
<span class="sd">    2. Data structuring</span>
<span class="sd">    3. Score normalization</span>
<span class="sd">    4. Duplicate merging</span>

<span class="sd">    Why important:</span>
<span class="sd">    - Ensures consistent output format</span>
<span class="sd">    - Improves result quality</span>
<span class="sd">    - Enables reliable downstream processing</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">process_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                       <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Process and structure analysis results.</span>

<span class="sd">        Steps:</span>
<span class="sd">        1. Validate result format</span>
<span class="sd">        2. Normalize confidence scores</span>
<span class="sd">        3. Merge similar signals</span>
<span class="sd">        4. Apply business rules</span>
<span class="sd">        """</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_result</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                <span class="n">normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_scores</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="n">structured</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure_data</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
                <span class="n">processed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structured</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_similar</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
</code></pre></div></div>










<button class="collapsible">Quality Control</button><div class="content"><h3 id="1-validation-rules">1. Validation Rules</h3><p>Define quality standards:</p><div class="codehilite"><pre><span></span><code><span class="n">validation_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'confidence_threshold'</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
    <span class="s1">'required_fields'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'signal_type'</span><span class="p">,</span>
        <span class="s1">'company_name'</span><span class="p">,</span>
        <span class="s1">'event_details'</span><span class="p">,</span>
        <span class="s1">'timeline'</span>
    <span class="p">],</span>
    <span class="s1">'score_weights'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'relevance'</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s1">'confidence'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s1">'completeness'</span><span class="p">:</span> <span class="mf">0.3</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-quality-metrics">2. Quality Metrics</h3><p>Monitor analysis quality:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">QualityMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Monitors analysis quality metrics.</span>

<span class="sd">    Metrics tracked:</span>
<span class="sd">    1. Accuracy (via sampling)</span>
<span class="sd">    2. Confidence distribution</span>
<span class="sd">    3. Processing success rate</span>
<span class="sd">    4. Result completeness</span>

<span class="sd">    Why monitoring matters:</span>
<span class="sd">    - Detect quality degradation early</span>
<span class="sd">    - Identify areas for improvement</span>
<span class="sd">    - Maintain high signal quality</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Calculate quality metrics for results.</span>

<span class="sd">        Metrics:</span>
<span class="sd">        - Average confidence</span>
<span class="sd">        - Completion rate</span>
<span class="sd">        - Error rate</span>
<span class="sd">        - Processing time</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'avg_confidence'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_confidence</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
            <span class="s1">'completion_rate'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_completion</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
            <span class="s1">'error_rate'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_error_rate</span><span class="p">(</span><span class="n">results</span><span class="p">),</span>
            <span class="s1">'processing_time'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_processing_time</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Prompt Structure</button><div class="content"><h3 id="anatomy-of-an-effective-prompt">Anatomy of an Effective Prompt</h3><p>A well-structured prompt consists of several key components:</p><ol>
<li><strong>Role Definition</strong>
<code>python
   """
   You are a B2B sales and marketing specialist in [industry].
   Your expertise includes [specific areas].
   """</code></li>
<li>Defines LLM's expertise domain</li>
<li>Sets context for analysis</li>
<li>
<p>Focuses on specific industry knowledge</p>
</li>
<li>
<p><strong>Task Description</strong>
   ```python
   """
   Your task is to analyze [content type] to identify [specific signals].
   Key characteristics of target signals:</p>
</li>
<li>Signal type A: [description]</li>
<li>Signal type B: [description]
   """
   ```</li>
<li>Clear objective statement</li>
<li>Specific signal definitions</li>
<li>
<p>Explicit success criteria</p>
</li>
<li>
<p><strong>Analysis Framework</strong>
   ```python
   """
   Key Analysis Points:</p>
</li>
<li>Content scope: [what to analyze]</li>
<li>Entity extraction: [what to look for]</li>
<li>Qualification criteria: [how to evaluate]</li>
<li>Exclusion rules: [what to ignore]
   """
   ```</li>
<li>Structured analysis approach</li>
<li>Clear evaluation criteria</li>
<li>
<p>Explicit exclusion rules</p>
</li>
<li>
<p><strong>Response Format</strong>
<code>python
   """
   Return results as Python list:
   [
       "entity_name",      # Company or organization
       signal_strength,    # Numerical score
       "revenue_range",    # Standardized range
       "summary",         # Brief overview
       "notes",          # Analysis details
       "context"         # Source context
   ]
   """</code></p>
</li>
<li>Strict format definition</li>
<li>Type specifications</li>
<li>Field descriptions</li>
</ol><h3 id="example-implementation">Example Implementation</h3><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PromptBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Builds analysis prompts from components.</span>

<span class="sd">    Key features:</span>
<span class="sd">    1. Modular prompt construction</span>
<span class="sd">    2. Template customization</span>
<span class="sd">    3. Format validation</span>
<span class="sd">    4. Example integration</span>

<span class="sd">    Example usage:</span>
<span class="sd">        builder = PromptBuilder(industry='warehouse_tech')</span>
<span class="sd">        prompt = builder.build_prompt(target='motion_sensors')</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">build_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">custom_rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Construct complete analysis prompt.</span>

<span class="sd">        Components:</span>
<span class="sd">        1. Role and expertise</span>
<span class="sd">        2. Task definition</span>
<span class="sd">        3. Analysis framework</span>
<span class="sd">        4. Response format</span>
<span class="sd">        5. Examples</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"""</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_role_definition</span><span class="p">()</span><span class="si">}</span>

<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_task_description</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="si">}</span>

<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_analysis_framework</span><span class="p">(</span><span class="n">custom_rules</span><span class="p">)</span><span class="si">}</span>

<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_response_format</span><span class="p">()</span><span class="si">}</span>

<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_examples</span><span class="p">()</span><span class="si">}</span>
<span class="s2">        """</span>
</code></pre></div><h3 id="best-practices">Best Practices</h3><ol>
<li><strong>Signal Definition</strong></li>
<li>Be specific about what constitutes a signal</li>
<li>Include both positive and negative examples</li>
<li>
<p>Define clear qualification criteria</p>
</li>
<li>
<p><strong>Context Management</strong></p>
</li>
<li>Provide industry-specific context</li>
<li>Include relevant business rules</li>
<li>
<p>Define scope and limitations</p>
</li>
<li>
<p><strong>Format Control</strong></p>
</li>
<li>Use strict output formatting</li>
<li>Define data types explicitly</li>
<li>
<p>Include validation rules</p>
</li>
<li>
<p><strong>Example Quality</strong></p>
</li>
<li>Provide diverse examples</li>
<li>Include edge cases</li>
<li>Show both good and bad matches</li>
</ol><h3 id="quality-metrics">Quality Metrics</h3><div class="codehilite"><pre><span></span><code><span class="n">prompt_quality_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'clarity'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'role_definition'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># 0-1 score</span>
        <span class="s1">'task_description'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">'analysis_framework'</span><span class="p">:</span> <span class="mf">0.0</span>
    <span class="p">},</span>
    <span class="s1">'completeness'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'required_components'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'example_coverage'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">'validation_rules'</span><span class="p">:</span> <span class="mf">0.0</span>
    <span class="p">},</span>
    <span class="s1">'effectiveness'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'signal_accuracy'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">'noise_reduction'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">'processing_efficiency'</span><span class="p">:</span> <span class="mf">0.0</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="../prompts/structure.md">Prompt Structure Guide</a></li>
<li><a href="../prompts/llm.md">LLM Integration</a></li>
<li><a href="../performance/metrics.md">Quality Metrics</a></li>
<li><a href="../troubleshooting/common-issues.md">Error Handling</a></li>
</ul></div>

                </article>
                
                <article id="business-processes-search-config">
                    <h1 id="search-configuration">Search Configuration</h1>
<button class="collapsible">Overview</button><div class="content"><p>Search configuration is a critical part of the signal detection process. A well-configured search determines:
- Quality of discovered signals
- Processing efficiency
- Resource utilization
- Result relevance</p></div>

<button class="collapsible">Configuration Structure</button><div class="content"><h3 id="basic-configuration">Basic Configuration</h3><div class="codehilite"><pre><span></span><code><span class="c1"># Example of basic search configuration</span>
<span class="n">search_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'query'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'text'</span><span class="p">:</span> <span class="s1">'office relocation announcement'</span><span class="p">,</span>
        <span class="s1">'industry'</span><span class="p">:</span> <span class="s1">'real estate'</span><span class="p">,</span>
        <span class="s1">'region'</span><span class="p">:</span> <span class="s1">'North America'</span>
    <span class="p">},</span>
    <span class="s1">'timeframe'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'days_back'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">'update_interval'</span><span class="p">:</span> <span class="s1">'12h'</span>
    <span class="p">},</span>
    <span class="s1">'sources'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'news'</span><span class="p">,</span> <span class="s1">'press-releases'</span><span class="p">,</span> <span class="s1">'company-blogs'</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div><h3 id="advanced-settings">Advanced Settings</h3><div class="codehilite"><pre><span></span><code><span class="c1"># Extended configuration with advanced options</span>
<span class="n">advanced_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'filters'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'min_company_size'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s1">'exclude_industries'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'retail'</span><span class="p">],</span>
        <span class="s1">'required_terms'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'expansion'</span><span class="p">,</span> <span class="s1">'growth'</span><span class="p">],</span>
        <span class="s1">'excluded_terms'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'bankruptcy'</span><span class="p">,</span> <span class="s1">'downsizing'</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">'processing'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'batch_size'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">'priority'</span><span class="p">:</span> <span class="s1">'high'</span><span class="p">,</span>
        <span class="s1">'deduplication_threshold'</span><span class="p">:</span> <span class="mf">0.85</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>




<button class="collapsible">Query Development</button><div class="content"><h3 id="1-query-building">1. Query Building</h3><p>Best practices for constructing effective queries:</p><ul>
<li><strong>Precision vs Recall</strong>  ```python
  # High precision query
  "company AND (relocating OR relocation) AND office"</li>
</ul><p># High recall query
  "company AND (move OR moving OR relocate OR relocating OR relocation)"  ```</p><ul>
<li><strong>Industry-Specific Terms</strong>  ```python
  # Technology industry
  terms = [
      'tech hub',
      'development center',
      'R&amp;D facility'
  ]</li>
</ul><p># Manufacturing industry
  terms = [
      'production facility',
      'manufacturing plant',
      'distribution center'
  ]  ```</p><h3 id="2-source-selection">2. Source Selection</h3><p>Configure data sources based on signal type:</p><div class="codehilite"><pre><span></span><code><span class="n">source_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'primary_sources'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'news'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'priority'</span><span class="p">:</span> <span class="s1">'high'</span><span class="p">,</span>
            <span class="s1">'refresh_rate'</span><span class="p">:</span> <span class="s1">'6h'</span><span class="p">,</span>
            <span class="s1">'credibility_threshold'</span><span class="p">:</span> <span class="mf">0.8</span>
        <span class="p">},</span>
        <span class="s1">'press_releases'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'priority'</span><span class="p">:</span> <span class="s1">'high'</span><span class="p">,</span>
            <span class="s1">'refresh_rate'</span><span class="p">:</span> <span class="s1">'12h'</span><span class="p">,</span>
            <span class="s1">'credibility_threshold'</span><span class="p">:</span> <span class="mf">0.9</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'secondary_sources'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'blogs'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'priority'</span><span class="p">:</span> <span class="s1">'medium'</span><span class="p">,</span>
            <span class="s1">'refresh_rate'</span><span class="p">:</span> <span class="s1">'24h'</span><span class="p">,</span>
            <span class="s1">'credibility_threshold'</span><span class="p">:</span> <span class="mf">0.6</span>
        <span class="p">},</span>
        <span class="s1">'social_media'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'priority'</span><span class="p">:</span> <span class="s1">'low'</span><span class="p">,</span>
            <span class="s1">'refresh_rate'</span><span class="p">:</span> <span class="s1">'1h'</span><span class="p">,</span>
            <span class="s1">'credibility_threshold'</span><span class="p">:</span> <span class="mf">0.4</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Performance Optimization</button><div class="content"><h3 id="1-query-optimization">1. Query Optimization</h3><p>Strategies for improving search efficiency:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">QueryOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes search queries for better performance and accuracy.</span>

<span class="sd">    Key features:</span>
<span class="sd">    1. Term relevance analysis</span>
<span class="sd">    2. Query expansion</span>
<span class="sd">    3. Performance monitoring</span>
<span class="sd">    4. Result quality tracking</span>

<span class="sd">    Example usage:</span>
<span class="sd">        optimizer = QueryOptimizer(config)</span>
<span class="sd">        optimized_query = await optimizer.optimize(query)</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize query based on historical performance.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Analyze term effectiveness</span>
<span class="sd">        2. Check historical results</span>
<span class="sd">        3. Apply optimization rules</span>
<span class="sd">        4. Validate changes</span>
<span class="sd">        """</span>
        <span class="c1"># Implementation details</span>
        <span class="k">pass</span>
</code></pre></div><h3 id="2-resource-management">2. Resource Management</h3><p>Control resource usage during search:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SearchResourceManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages resources for search operations.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Rate limiting</span>
<span class="sd">    2. Concurrent search limits</span>
<span class="sd">    3. Priority queuing</span>
<span class="sd">    4. Resource allocation</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">allocate_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                               <span class="n">search_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Allocate resources based on search configuration.</span>

<span class="sd">        Considerations:</span>
<span class="sd">        1. Current system load</span>
<span class="sd">        2. Search priority</span>
<span class="sd">        3. Expected result volume</span>
<span class="sd">        4. Available resources</span>
<span class="sd">        """</span>
        <span class="c1"># Implementation details</span>
        <span class="k">pass</span>
</code></pre></div></div>






<button class="collapsible">Quality Assurance</button><div class="content"><h3 id="1-result-validation">1. Result Validation</h3><p>Ensure search result quality:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ResultValidator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validates search results for quality and relevance.</span>

<span class="sd">    Checks:</span>
<span class="sd">    1. Content relevance</span>
<span class="sd">    2. Source credibility</span>
<span class="sd">    3. Data completeness</span>
<span class="sd">    4. Signal strength</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">validate_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate and filter search results.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Check relevance scores</span>
<span class="sd">        2. Verify source credibility</span>
<span class="sd">        3. Validate data format</span>
<span class="sd">        4. Filter low-quality results</span>
<span class="sd">        """</span>
        <span class="c1"># Implementation details</span>
        <span class="k">pass</span>
</code></pre></div></div>



<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="../overview/data-pipeline.md">Data Pipeline Overview</a></li>
<li><a href="../developer/search-module.md">Search Module Details</a></li>
<li><a href="../performance/tuning.md">Performance Tuning</a></li>
<li><a href="../troubleshooting/common-issues.md">Error Handling</a></li>
</ul></div>

                </article>
                
            </section>
            
            <section id="prompts">
                <h2>Prompts</h2>
                
                <article id="prompts-index">
                    <h1 id="prompts-overview">Prompts Overview</h1>
<button class="collapsible">Introduction</button><div class="content"><p>Karhuno prompts are:</p><ul>
<li>
<p>Business case specific</p>
</li>
<li>
<p>Structured for consistent output</p>
</li>
<li>
<p>Optimized for signal detection</p>
</li>
<li>
<p>Language-aware (multilingual support)</p>
</li>
</ul><p>Analysis Flow:</p><div class="codehilite"><pre><span></span><code>Setup -&gt; Configuration -&gt; Collection -&gt; Analysis -&gt; Review -&gt; Delivery
                                                      |
                                                      v
                                               Improvement -&gt; Back to Config
</code></pre></div></div>




<button class="collapsible">Prompt Components</button><div class="content"><h3 id="1-role-definition">1. Role Definition</h3><p>Set LLM expertise and context:</p><div class="codehilite"><pre><span></span><code>Example:
"You are an experienced B2B sales and marketing specialist in warehouse technology.
Your expertise includes energy efficiency, facility operations, and business signal analysis.
You understand technical specifications and their business implications."
</code></pre></div><h3 id="2-task-description">2. Task Description</h3><p>Define analysis objectives:</p><div class="codehilite"><pre><span></span><code>Example:
"Analyze web pages and search results to identify potential leads for [product].
Focus on:
- Company's facility type
- Energy efficiency needs
- Scale of operations
- Decision readiness"
</code></pre></div><h3 id="3-response-format">3. Response Format</h3><p>Specify output structure:</p><div class="codehilite"><pre><span></span><code>Example:
"Return results as a Python list:
[
    'Company name or N/A',
    Signal strength (0-4),
    'Revenue range',
    'Company summary',
    'Sales team notes',
    'News context'
]"
</code></pre></div></div>









<button class="collapsible">Business Cases</button><div class="content"><h3 id="1-warehouse-sensors-case">1. Warehouse Sensors Case</h3><p>Example implementation:</p><div class="codehilite"><pre><span></span><code>Key Elements:
- Focus on energy efficiency
- Cold storage priority
- Revenue-based targeting
- Regional preferences
- Language: Russian responses

Search Queries:
- Warehouse modernization
- Energy efficiency projects
- Cold storage facilities
- Logistics center expansion
</code></pre></div><h3 id="2-construction-equipment-case">2. Construction Equipment Case</h3><p>Example implementation:</p><div class="codehilite"><pre><span></span><code>Key Elements:
- Physical operations focus
- Equipment usage potential
- International scope
- Website validation
- Language: English responses

Search Queries:
- Construction acquisitions
- Infrastructure projects
- Equipment fleet expansion
- Facility maintenance
</code></pre></div></div>






<button class="collapsible">Search Configuration</button><div class="content"><h3 id="1-query-structure">1. Query Structure</h3><p>Building effective queries:</p><div class="codehilite"><pre><span></span><code>Components:
- Core business terms
- Action indicators
- Industry specifics
- Geographic focus

Example Set:
- "warehouse automation news"
- "logistics technology investment"
- "cold storage facility expansion"
- "energy efficiency projects"
</code></pre></div><h3 id="2-query-management">2. Query Management</h3><p>Organizing search queries:</p><div class="codehilite"><pre><span></span><code>Categories:
- Direct business signals
- Industry developments
- Company activities
- Market changes

Languages:
- Primary market language
- Additional relevant languages
- Regional variations
</code></pre></div></div>






<button class="collapsible">Best Practices</button><div class="content"><h3 id="1-prompt-development">1. Prompt Development</h3><p>Key considerations:</p><ul>
<li>Match business case specifics</li>
<li>Include clear examples</li>
<li>Define validation criteria</li>
<li>Consider language requirements</li>
<li>Test with sample data</li>
</ul><h3 id="2-query-optimization">2. Query Optimization</h3><p>Search improvement:</p><ul>
<li>Monitor result quality</li>
<li>Adjust based on feedback</li>
<li>Include/exclude terms</li>
<li>Track success patterns</li>
<li>Document effective approaches</li>
</ul><h3 id="3-quality-control">3. Quality Control</h3><p>Maintaining standards:</p><ul>
<li>Regular prompt review</li>
<li>Query effectiveness check</li>
<li>Result validation</li>
<li>Language accuracy</li>
<li>Format consistency</li>
</ul></div>









<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="results.md">Results Structure</a></li>
<li><a href="../business-processes/analysis-process.md">Analysis Process</a></li>
<li><a href="../business-processes/search-config.md">Search Configuration</a></li>
<li><a href="../performance/metrics.md">Quality Metrics</a></li>
</ul></div>

                </article>
                
                <article id="prompts-structure">
                    <h1 id="prompt-structure-guide">Prompt Structure Guide</h1>
<button class="collapsible">Overview</button><div class="content"><p>A well-structured prompt is critical for effective signal analysis because:
- It guides the LLM in understanding the business context
- Ensures consistent and structured responses
- Helps filter out irrelevant information
- Makes analysis results actionable for sales teams</p></div>

<button class="collapsible">Key Components</button><div class="content"><h3 id="1-role-and-context">1. Role and Context</h3><p>Define who the LLM should be and what expertise it should have:</p><div class="codehilite"><pre><span></span><code>Example:
You are a B2B sales and marketing specialist in [industry].
Your expertise includes [specific areas].
You understand [technical aspects] and their business implications.
</code></pre></div><p>Key points:
- Be specific about the industry expertise
- Define relevant technical knowledge
- Set the business context
- Explain why this expertise matters</p><h3 id="2-task-description">2. Task Description</h3><p>Clearly explain what needs to be analyzed:</p><div class="codehilite"><pre><span></span><code>Example:
Your task is to analyze [content type] to identify potential leads for [product/service].
Key product features that matter:
- Feature A and its business benefit
- Feature B and its business benefit
- Feature C and its business benefit
</code></pre></div><p>Important aspects:
- Define the analysis objective
- Highlight key product features
- Connect features to business benefits
- Set clear expectations</p><h3 id="3-analysis-framework">3. Analysis Framework</h3><p>Provide clear criteria for analysis:</p><div class="codehilite"><pre><span></span><code>Example:
Key Analysis Points:
- What to look for in the text
- How to identify company names
- What revenue ranges to consider
- What industries to focus on
- What to exclude
</code></pre></div><p>Best practices:
- List specific indicators to look for
- Define clear exclusion criteria
- Provide revenue/size thresholds
- Explain priority factors</p><h3 id="4-signal-definition">4. Signal Definition</h3><p>Define what constitutes a valuable signal:</p><div class="codehilite"><pre><span></span><code>Example:
Signals Indicating Interest:
- Signal A (with explanation)
- Signal B (with explanation)
- Signal C (with explanation)

Special Focus:
- Priority customer types
- Key geographical regions
- Specific facility types
- Business situations
</code></pre></div><p>Remember to:
- Define both positive and negative signals
- Explain why each signal matters
- Provide context for prioritization
- Include industry-specific nuances</p><h3 id="5-response-format">5. Response Format</h3><p>Specify exactly how the LLM should structure its response:</p><div class="codehilite"><pre><span></span><code>Example:
Return results as a list:
["Company name", 
 signal_strength (0-4), 
 "revenue_range",
 "company_summary",
 "sales_notes",
 "context_summary"]
</code></pre></div><p>Important:
- Use consistent formats
- Define all fields clearly
- Provide value ranges
- Include examples</p><h3 id="6-examples">6. Examples</h3><p>Provide clear examples of good and bad responses:</p><div class="codehilite"><pre><span></span><code>Good example:
["TechCorp", 4, "up to 1000M", "Detailed summary...", "Specific sales approach...", "Relevant context..."]

Bad example:
["Unknown", 1, "unknown", "Limited info...", "No clear approach...", "Vague context..."]
</code></pre></div><p>Why examples matter:
- Show expected quality level
- Demonstrate format compliance
- Illustrate decision-making
- Help calibrate responses</p></div>
























<button class="collapsible">Best Practices</button><div class="content"><h3 id="1-clarity">1. Clarity</h3><ul>
<li>Use simple, clear language</li>
<li>Break down complex criteria</li>
<li>Provide specific examples</li>
<li>Explain why things matter</li>
</ul><h3 id="2-consistency">2. Consistency</h3><ul>
<li>Use consistent terminology</li>
<li>Maintain format throughout</li>
<li>Keep scoring scales uniform</li>
<li>Use standard categories</li>
</ul><h3 id="3-completeness">3. Completeness</h3><ul>
<li>Include all necessary context</li>
<li>Define all required fields</li>
<li>Explain all criteria</li>
<li>Provide fallback options</li>
</ul><h3 id="4-quality-control">4. Quality Control</h3><ul>
<li>Define minimum quality standards</li>
<li>Include validation criteria</li>
<li>Specify required elements</li>
<li>Set clear boundaries</li>
</ul></div>








<button class="collapsible">Common Mistakes to Avoid</button><div class="content"><ol>
<li><strong>Vague Instructions</strong></li>
<li>Too general criteria</li>
<li>Unclear priorities</li>
<li>Undefined terms</li>
<li>
<p>Missing context</p>
</li>
<li>
<p><strong>Format Issues</strong></p>
</li>
<li>Inconsistent structure</li>
<li>Unclear field definitions</li>
<li>Missing examples</li>
<li>
<p>Ambiguous scales</p>
</li>
<li>
<p><strong>Context Problems</strong></p>
</li>
<li>Insufficient background</li>
<li>Missing industry context</li>
<li>Unclear priorities</li>
<li>Undefined scope</li>
</ol></div>

<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="../business-processes/analysis-process.md">Analysis Process</a></li>
<li><a href="../performance/metrics.md">Quality Metrics</a></li>
<li><a href="../best-practices/index.md">Best Practices</a></li>
<li><a href="../guides/use-cases.md">Case Studies</a></li>
</ul></div>

                </article>
                
                <article id="prompts-results">
                    <h1 id="analysis-results-structure">Analysis Results Structure</h1>
<button class="collapsible">Overview</button><div class="content"><p>Analysis results in Karhuno are:
- Raw LLM responses in Python list format
- Parsed into structured table data
- Customized for each business case
- Validated against defined rules</p></div>

<button class="collapsible">Response Format</button><div class="content"><h3 id="1-basic-structure">1. Basic Structure</h3><p>LLM returns a Python list string that is parsed into columns:</p><div class="codehilite"><pre><span></span><code>Example raw response:
["Company Name", 4, "up to 1000M", "Company description...", "Sales notes...", "News context..."]

Becomes table row:
| Company | Signal Strength | Revenue | Description | Sales Notes | Context |
|---------|----------------|----------|-------------|-------------|----------|
| Company Name | 4 | up to 1000M | Company... | Sales... | News... |
</code></pre></div><h3 id="2-case-specific-elements">2. Case-Specific Elements</h3><p>Response elements vary by business case:</p><div class="codehilite"><pre><span></span><code>Warehouse Sensors Case:
- Company name (required)
- Signal strength (0-4)
- Revenue range
- Company summary in Russian
- Sales team notes in Russian
- News context in Russian

Construction Equipment Case:
- Company name (required)
- Potential rating (0-4)
- Sales notes in English
- Company description
- Revenue estimate
- Country
- Website
- Assumed website
</code></pre></div><h3 id="3-common-elements">3. Common Elements</h3><p>While formats vary, some elements are standard:
- Company identification
- Signal/potential strength
- Revenue information
- Business context
- Sales guidance</p></div>








<button class="collapsible">Business Case Variations</button><div class="content"><h3 id="1-time-sensitivity">1. Time Sensitivity</h3><p>Different importance by case:</p><div class="codehilite"><pre><span></span><code>Office Design:
- Timing is critical
- Project windows are short
- Immediate action needed

Equipment Sales:
- Longer sales cycles
- Timing less critical
- Focus on proper qualification
</code></pre></div><h3 id="2-geographic-focus">2. Geographic Focus</h3><p>Location importance varies:</p><div class="codehilite"><pre><span></span><code>Local Services:
- Region is critical
- Physical presence needed
- Local context important

Global Products:
- Wider geography
- Remote sales possible
- International context
</code></pre></div></div>






<button class="collapsible">Data Processing</button><div class="content"><h3 id="1-response-parsing">1. Response Parsing</h3><p>Converting LLM output to data:</p><div class="codehilite"><pre><span></span><code>1. LLM returns string in format: ["elem1", "elem2", ...]
2. String is parsed into Python list
3. List elements map to table columns
4. Column names match prompt output format
</code></pre></div><h3 id="2-validation-rules">2. Validation Rules</h3><p>Basic validation principles:</p><div class="codehilite"><pre><span></span><code>Required Elements:
- Company name (or N/A)
- Signal strength (numeric)
- Revenue information
- Business context

Format Rules:
- Signal strength must be 0-4
- Revenue in defined ranges
- Text fields within length limits
</code></pre></div></div>






<button class="collapsible">Best Practices</button><div class="content"><h3 id="1-format-definition">1. Format Definition</h3><p>When defining output format:
- Match columns to business needs
- Keep consistent order
- Include all required fields
- Consider data processing needs</p><h3 id="2-quality-control">2. Quality Control</h3><p>Ensure data quality:
- Define clear validation rules
- Check for required elements
- Validate numeric ranges
- Verify text formatting</p></div>




<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="structure.md">Prompt Structure</a></li>
<li><a href="../business-processes/analysis-process.md">Analysis Process</a></li>
<li><a href="../overview/data-pipeline.md">Data Pipeline</a></li>
<li><a href="../api/examples.md">API Examples</a></li>
</ul></div>

                </article>
                
            </section>
            
            <section id="api">
                <h2>API Reference</h2>
                
                <article id="api-overview">
                    <h1 id="api-overview">API Overview</h1>
<button class="collapsible">Introduction</button><div class="content"><p>Karhuno API provides:
- Search configuration management
- Analysis process control
- Result retrieval and filtering
- System monitoring</p><blockquote>
<p><strong>Important Note</strong>: While currently used internally, the API is being designed for SaaS transition. All endpoints, documentation, and interfaces should be developed with external users in mind, focusing on:
- Clear, self-service workflows
- Robust error handling and guidance
- Comprehensive documentation
- Secure multi-tenant architecture
- User-friendly interfaces</p>
</blockquote></div>


<button class="collapsible">Core Concepts</button><div class="content"><h3 id="1-authentication">1. Authentication</h3><p>API uses token-based authentication:</p><div class="codehilite"><pre><span></span><code><span class="n">auth_flow</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'Bearer token'</span><span class="p">,</span>
    <span class="s1">'format'</span><span class="p">:</span> <span class="s1">'JWT'</span><span class="p">,</span>
    <span class="s1">'expiration'</span><span class="p">:</span> <span class="s1">'24h'</span><span class="p">,</span>
    <span class="s1">'scope_based'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">'refresh_enabled'</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-rate-limiting">2. Rate Limiting</h3><p>Default API limits:</p><div class="codehilite"><pre><span></span><code><span class="n">rate_limits</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'search'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'requests'</span><span class="p">:</span> <span class="s1">'100/minute'</span><span class="p">,</span>
        <span class="s1">'data_volume'</span><span class="p">:</span> <span class="s1">'10MB/request'</span>
    <span class="p">},</span>
    <span class="s1">'analysis'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'requests'</span><span class="p">:</span> <span class="s1">'50/minute'</span><span class="p">,</span>
        <span class="s1">'batch_size'</span><span class="p">:</span> <span class="s1">'1000 items'</span>
    <span class="p">},</span>
    <span class="s1">'results'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'requests'</span><span class="p">:</span> <span class="s1">'300/minute'</span><span class="p">,</span>
        <span class="s1">'data_volume'</span><span class="p">:</span> <span class="s1">'50MB/request'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="3-response-format">3. Response Format</h3><p>Standard response structure:</p><div class="codehilite"><pre><span></span><code><span class="n">response_format</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'success'</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="s1">'data'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'results'</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
        <span class="s1">'metadata'</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="p">},</span>
    <span class="s1">'error'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'code'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'message'</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">'details'</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="p">},</span>
    <span class="s1">'pagination'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'page'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">'per_page'</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">'total'</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">API Components</button><div class="content"><h3 id="1-search-api">1. Search API</h3><p>Manage search configurations:</p><div class="codehilite"><pre><span></span><code><span class="n">search_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'configuration'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'create'</span><span class="p">:</span> <span class="s1">'POST /api/v1/search/config'</span><span class="p">,</span>
        <span class="s1">'update'</span><span class="p">:</span> <span class="s1">'PUT /api/v1/search/config/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'delete'</span><span class="p">:</span> <span class="s1">'DELETE /api/v1/search/config/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'list'</span><span class="p">:</span> <span class="s1">'GET /api/v1/search/config'</span>
    <span class="p">},</span>
    <span class="s1">'execution'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'start'</span><span class="p">:</span> <span class="s1">'POST /api/v1/search/execute'</span><span class="p">,</span>
        <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'GET /api/v1/search/status/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'stop'</span><span class="p">:</span> <span class="s1">'POST /api/v1/search/stop/</span><span class="si">{id}</span><span class="s1">'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-analysis-api">2. Analysis API</h3><p>Control analysis process:</p><div class="codehilite"><pre><span></span><code><span class="n">analysis_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'prompts'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'create'</span><span class="p">:</span> <span class="s1">'POST /api/v1/analysis/prompt'</span><span class="p">,</span>
        <span class="s1">'update'</span><span class="p">:</span> <span class="s1">'PUT /api/v1/analysis/prompt/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'delete'</span><span class="p">:</span> <span class="s1">'DELETE /api/v1/analysis/prompt/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'list'</span><span class="p">:</span> <span class="s1">'GET /api/v1/analysis/prompt'</span>
    <span class="p">},</span>
    <span class="s1">'execution'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'start'</span><span class="p">:</span> <span class="s1">'POST /api/v1/analysis/execute'</span><span class="p">,</span>
        <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'GET /api/v1/analysis/status/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'stop'</span><span class="p">:</span> <span class="s1">'POST /api/v1/analysis/stop/</span><span class="si">{id}</span><span class="s1">'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="3-results-api">3. Results API</h3><p>Manage analysis results:</p><div class="codehilite"><pre><span></span><code><span class="n">results_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'retrieval'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'get'</span><span class="p">:</span> <span class="s1">'GET /api/v1/results/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'list'</span><span class="p">:</span> <span class="s1">'GET /api/v1/results'</span><span class="p">,</span>
        <span class="s1">'export'</span><span class="p">:</span> <span class="s1">'GET /api/v1/results/export/</span><span class="si">{id}</span><span class="s1">'</span>
    <span class="p">},</span>
    <span class="s1">'filtering'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'apply'</span><span class="p">:</span> <span class="s1">'POST /api/v1/results/filter'</span><span class="p">,</span>
        <span class="s1">'save'</span><span class="p">:</span> <span class="s1">'POST /api/v1/results/filter/save'</span><span class="p">,</span>
        <span class="s1">'load'</span><span class="p">:</span> <span class="s1">'GET /api/v1/results/filter/</span><span class="si">{id}</span><span class="s1">'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Error Handling</button><div class="content"><h3 id="1-error-codes">1. Error Codes</h3><p>Standard error responses:</p><div class="codehilite"><pre><span></span><code><span class="n">error_codes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'authentication'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'401'</span><span class="p">:</span> <span class="s1">'Invalid or missing token'</span><span class="p">,</span>
        <span class="s1">'403'</span><span class="p">:</span> <span class="s1">'Insufficient permissions'</span>
    <span class="p">},</span>
    <span class="s1">'validation'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'400'</span><span class="p">:</span> <span class="s1">'Invalid request format'</span><span class="p">,</span>
        <span class="s1">'422'</span><span class="p">:</span> <span class="s1">'Invalid data provided'</span>
    <span class="p">},</span>
    <span class="s1">'resource'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'404'</span><span class="p">:</span> <span class="s1">'Resource not found'</span><span class="p">,</span>
        <span class="s1">'409'</span><span class="p">:</span> <span class="s1">'Resource conflict'</span>
    <span class="p">},</span>
    <span class="s1">'server'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'500'</span><span class="p">:</span> <span class="s1">'Internal server error'</span><span class="p">,</span>
        <span class="s1">'503'</span><span class="p">:</span> <span class="s1">'Service unavailable'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-error-response">2. Error Response</h3><p>Example error structure:</p><div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VALIDATION_ERROR"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid search configuration"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keywords"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cannot be empty"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Best Practices</button><div class="content"><h3 id="1-rate-limiting">1. Rate Limiting</h3><p>Handle rate limits properly:</p><div class="codehilite"><pre><span></span><code><span class="n">rate_limit_handling</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'monitoring'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'track_limits'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'check_headers'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'implement_backoff'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'optimization'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'batch_requests'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'cache_responses'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'distribute_load'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-error-handling">2. Error Handling</h3><p>Implement robust error handling:</p><div class="codehilite"><pre><span></span><code><span class="n">error_handling</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'retry_strategy'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'max_attempts'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">'backoff_factor'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">'retry_codes'</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">'logging'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'log_errors'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'include_context'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'alert_on_critical'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="authentication.md">API Authentication</a></li>
<li><a href="endpoints.md">API Endpoints</a></li>
<li><a href="examples.md">API Examples</a></li>
<li><a href="../overview/architecture.md">System Architecture</a> </li>
</ul></div>

                </article>
                
                <article id="api-authentication">
                    <h1 id="api-authentication">API Authentication</h1>
<button class="collapsible">Overview</button><div class="content"><p>Authentication system provides:
- Secure access control
- Role-based permissions
- Token management
- Request validation</p></div>

<button class="collapsible">Authentication Flow</button><div class="content"><h3 id="1-token-generation">1. Token Generation</h3><p>Get authentication token:</p><div class="codehilite"><pre><span></span><code><span class="n">auth_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'login'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/auth/login'</span><span class="p">,</span>
        <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'username'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'password'</span><span class="p">:</span> <span class="s1">'str'</span>
        <span class="p">},</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'access_token'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'refresh_token'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'token_type'</span><span class="p">:</span> <span class="s1">'Bearer'</span><span class="p">,</span>
            <span class="s1">'expires_in'</span><span class="p">:</span> <span class="mi">86400</span>  <span class="c1"># 24 hours</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'refresh'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/auth/refresh'</span><span class="p">,</span>
        <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'refresh_token'</span><span class="p">:</span> <span class="s1">'str'</span>
        <span class="p">},</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'access_token'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'expires_in'</span><span class="p">:</span> <span class="mi">86400</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-token-usage">2. Token Usage</h3><p>Include token in requests:</p><div class="codehilite"><pre><span></span><code><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Authorization'</span><span class="p">:</span> <span class="s1">'Bearer &lt;access_token&gt;'</span><span class="p">,</span>
    <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span><span class="p">,</span>
    <span class="s1">'Accept'</span><span class="p">:</span> <span class="s1">'application/json'</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Authorization</button><div class="content"><h3 id="1-role-based-access">1. Role-Based Access</h3><p>Permission levels:</p><div class="codehilite"><pre><span></span><code><span class="n">role_permissions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'admin'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'description'</span><span class="p">:</span> <span class="s1">'Full system access'</span><span class="p">,</span>
        <span class="s1">'permissions'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'all'</span><span class="p">],</span>
        <span class="s1">'scope'</span><span class="p">:</span> <span class="s1">'system'</span>
    <span class="p">},</span>
    <span class="s1">'analyst'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'description'</span><span class="p">:</span> <span class="s1">'Analysis management'</span><span class="p">,</span>
        <span class="s1">'permissions'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'search:read'</span><span class="p">,</span>
            <span class="s1">'search:write'</span><span class="p">,</span>
            <span class="s1">'analysis:read'</span><span class="p">,</span>
            <span class="s1">'analysis:write'</span><span class="p">,</span>
            <span class="s1">'results:read'</span>
        <span class="p">],</span>
        <span class="s1">'scope'</span><span class="p">:</span> <span class="s1">'workspace'</span>
    <span class="p">},</span>
    <span class="s1">'viewer'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'description'</span><span class="p">:</span> <span class="s1">'Read-only access'</span><span class="p">,</span>
        <span class="s1">'permissions'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'search:read'</span><span class="p">,</span>
            <span class="s1">'analysis:read'</span><span class="p">,</span>
            <span class="s1">'results:read'</span>
        <span class="p">],</span>
        <span class="s1">'scope'</span><span class="p">:</span> <span class="s1">'workspace'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-permission-management">2. Permission Management</h3><p>Manage access rights:</p><div class="codehilite"><pre><span></span><code><span class="n">permission_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'roles'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'list'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
            <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/auth/roles'</span><span class="p">,</span>
            <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'roles'</span><span class="p">:</span> <span class="s1">'List[Dict]'</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'assign'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
            <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/auth/roles/assign'</span><span class="p">,</span>
            <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'user_id'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
                <span class="s1">'role'</span><span class="p">:</span> <span class="s1">'str'</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'permissions'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'check'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
            <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/auth/permissions/check'</span><span class="p">,</span>
            <span class="s1">'params'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'resource'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'action'</span><span class="p">:</span> <span class="s1">'str'</span>
            <span class="p">},</span>
            <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'allowed'</span><span class="p">:</span> <span class="s1">'bool'</span><span class="p">,</span>
                <span class="s1">'reason'</span><span class="p">:</span> <span class="s1">'Optional[str]'</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Security Measures</button><div class="content"><h3 id="1-token-security">1. Token Security</h3><p>Token protection:</p><div class="codehilite"><pre><span></span><code><span class="n">token_security</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'jwt'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'algorithm'</span><span class="p">:</span> <span class="s1">'HS256'</span><span class="p">,</span>
        <span class="s1">'expiration'</span><span class="p">:</span> <span class="s1">'24h'</span><span class="p">,</span>
        <span class="s1">'refresh_window'</span><span class="p">:</span> <span class="s1">'7d'</span>
    <span class="p">},</span>
    <span class="s1">'requirements'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'min_length'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="s1">'entropy'</span><span class="p">:</span> <span class="s1">'high'</span><span class="p">,</span>
        <span class="s1">'rotation'</span><span class="p">:</span> <span class="s1">'enabled'</span>
    <span class="p">},</span>
    <span class="s1">'storage'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'client'</span><span class="p">:</span> <span class="s1">'secure_storage'</span><span class="p">,</span>
        <span class="s1">'server'</span><span class="p">:</span> <span class="s1">'encrypted_db'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-request-validation">2. Request Validation</h3><p>Security checks:</p><div class="codehilite"><pre><span></span><code><span class="n">request_validation</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'headers'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'required'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'Authorization'</span><span class="p">,</span>
            <span class="s1">'Content-Type'</span>
        <span class="p">],</span>
        <span class="s1">'optional'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'X-Request-ID'</span><span class="p">,</span>
            <span class="s1">'X-Client-Version'</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">'token'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'validate_signature'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'check_expiration'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'verify_claims'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'rate_limiting'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'enabled'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'window'</span><span class="p">:</span> <span class="s1">'1m'</span><span class="p">,</span>
        <span class="s1">'max_requests'</span><span class="p">:</span> <span class="mi">100</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Error Handling</button><div class="content"><h3 id="1-authentication-errors">1. Authentication Errors</h3><p>Common error responses:</p><div class="codehilite"><pre><span></span><code><span class="n">auth_errors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'invalid_credentials'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'code'</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
        <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'Invalid username or password'</span>
    <span class="p">},</span>
    <span class="s1">'token_expired'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'code'</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
        <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'Token has expired'</span>
    <span class="p">},</span>
    <span class="s1">'invalid_token'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'code'</span><span class="p">:</span> <span class="mi">401</span><span class="p">,</span>
        <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'Invalid token format'</span>
    <span class="p">},</span>
    <span class="s1">'insufficient_permissions'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'code'</span><span class="p">:</span> <span class="mi">403</span><span class="p">,</span>
        <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'Insufficient permissions for this action'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-error-responses">2. Error Responses</h3><p>Example error format:</p><div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AUTH_ERROR"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Token has expired"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"expired_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T00:00:00Z"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"access"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Best Practices</button><div class="content"><h3 id="1-token-management">1. Token Management</h3><p>Client-side recommendations:</p><div class="codehilite"><pre><span></span><code><span class="n">token_management</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'storage'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'access_token'</span><span class="p">:</span> <span class="s1">'memory'</span><span class="p">,</span>
        <span class="s1">'refresh_token'</span><span class="p">:</span> <span class="s1">'secure_storage'</span>
    <span class="p">},</span>
    <span class="s1">'refresh'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'before_expiration'</span><span class="p">:</span> <span class="s1">'5m'</span><span class="p">,</span>
        <span class="s1">'retry_strategy'</span><span class="p">:</span> <span class="s1">'exponential'</span><span class="p">,</span>
        <span class="s1">'max_retries'</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="s1">'cleanup'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'on_logout'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'on_error'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-security-guidelines">2. Security Guidelines</h3><p>Implementation recommendations:</p><div class="codehilite"><pre><span></span><code><span class="n">security_guidelines</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'transport'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'use_https'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'verify_ssl'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'min_tls_version'</span><span class="p">:</span> <span class="s1">'1.2'</span>
    <span class="p">},</span>
    <span class="s1">'tokens'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'store_securely'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'clear_on_exit'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'refresh_early'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'errors'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'log_failures'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'notify_security'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'implement_lockout'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="overview.md">API Overview</a></li>
<li><a href="endpoints.md">API Endpoints</a></li>
<li><a href="examples.md">API Examples</a></li>
<li><a href="../security/overview.md">Security Setup</a> </li>
</ul></div>

                </article>
                
                <article id="api-endpoints">
                    <h1 id="api-endpoints">API Endpoints</h1>
<button class="collapsible">Overview</button><div class="content"><p>Karhuno API includes:
- Internal service endpoints
- External API integrations
- Utility endpoints</p><blockquote>
<p><strong>SaaS Readiness</strong>: All endpoints are designed with future SaaS deployment in mind:
- RESTful design for easy integration
- Consistent error handling
- Clear validation rules
- Multi-tenant support
- Rate limiting per client
- Detailed response metadata</p>
</blockquote></div>


<button class="collapsible">External API Integration</button><div class="content"><h3 id="1-xmlstock-api">1. XMLStock API</h3><p>Integration for data collection:</p><div class="codehilite"><pre><span></span><code><span class="n">xmlstock_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'search'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/external/xmlstock/search'</span><span class="p">,</span>
        <span class="s1">'params'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'query'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'filters'</span><span class="p">:</span> <span class="s1">'Dict[str, Any]'</span><span class="p">,</span>
            <span class="s1">'limit'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
            <span class="s1">'offset'</span><span class="p">:</span> <span class="s1">'int'</span>
        <span class="p">},</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'results'</span><span class="p">:</span> <span class="s1">'List[Dict]'</span><span class="p">,</span>
            <span class="s1">'total'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
            <span class="s1">'next_token'</span><span class="p">:</span> <span class="s1">'Optional[str]'</span>
        <span class="p">},</span>
        <span class="s1">'rate_limits'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'requests'</span><span class="p">:</span> <span class="s1">'100/minute'</span><span class="p">,</span>
            <span class="s1">'daily_quota'</span><span class="p">:</span> <span class="s1">'10000'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'status'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/external/xmlstock/status'</span><span class="p">,</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'quota_used'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
            <span class="s1">'quota_remaining'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
            <span class="s1">'reset_time'</span><span class="p">:</span> <span class="s1">'datetime'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Example request:</p><div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"warehouse automation news"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"date_from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"date_to"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-02-01"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"regions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"europe"</span><span class="p">,</span><span class="w"> </span><span class="s2">"north_america"</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-openai-api">2. OpenAI API</h3><p>Integration for analysis:</p><div class="codehilite"><pre><span></span><code><span class="n">openai_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'analyze'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/external/openai/analyze'</span><span class="p">,</span>
        <span class="s1">'params'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'text'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'prompt'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'model'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'temperature'</span><span class="p">:</span> <span class="s1">'float'</span><span class="p">,</span>
            <span class="s1">'max_tokens'</span><span class="p">:</span> <span class="s1">'int'</span>
        <span class="p">},</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'analysis'</span><span class="p">:</span> <span class="s1">'Dict[str, Any]'</span><span class="p">,</span>
            <span class="s1">'tokens_used'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
            <span class="s1">'model_used'</span><span class="p">:</span> <span class="s1">'str'</span>
        <span class="p">},</span>
        <span class="s1">'rate_limits'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tokens_per_minute'</span><span class="p">:</span> <span class="s1">'100000'</span><span class="p">,</span>
            <span class="s1">'requests_per_minute'</span><span class="p">:</span> <span class="s1">'500'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'status'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/external/openai/status'</span><span class="p">,</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'available_models'</span><span class="p">:</span> <span class="s1">'List[str]'</span><span class="p">,</span>
            <span class="s1">'quota_used'</span><span class="p">:</span> <span class="s1">'float'</span><span class="p">,</span>
            <span class="s1">'quota_remaining'</span><span class="p">:</span> <span class="s1">'float'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Example request:</p><div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Company XYZ announced expansion..."</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"prompt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Analyze this text for business signals..."</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gpt-4"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"temperature"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"max_tokens"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span>
<span class="p">}</span>
</code></pre></div></div>










<button class="collapsible">Internal Endpoints</button><div class="content"><h3 id="1-search-configuration">1. Search Configuration</h3><p>Manage search settings:</p><div class="codehilite"><pre><span></span><code><span class="n">search_config_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'create'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/search/config'</span><span class="p">,</span>
        <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'description'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'queries'</span><span class="p">:</span> <span class="s1">'List[str]'</span><span class="p">,</span>
            <span class="s1">'filters'</span><span class="p">:</span> <span class="s1">'Dict[str, Any]'</span><span class="p">,</span>
            <span class="s1">'schedule'</span><span class="p">:</span> <span class="s1">'Optional[str]'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'update'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'PUT'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/search/config/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
        <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'queries'</span><span class="p">:</span> <span class="s1">'List[str]'</span><span class="p">,</span>
            <span class="s1">'filters'</span><span class="p">:</span> <span class="s1">'Dict[str, Any]'</span><span class="p">,</span>
            <span class="s1">'active'</span><span class="p">:</span> <span class="s1">'bool'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'delete'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/search/config/</span><span class="si">{id}</span><span class="s1">'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-analysis-configuration">2. Analysis Configuration</h3><p>Manage analysis settings:</p><div class="codehilite"><pre><span></span><code><span class="n">analysis_config_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'prompt'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'create'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
            <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/analysis/prompt'</span><span class="p">,</span>
            <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'description'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'prompt_text'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'output_format'</span><span class="p">:</span> <span class="s1">'Dict[str, str]'</span><span class="p">,</span>
                <span class="s1">'examples'</span><span class="p">:</span> <span class="s1">'List[Dict]'</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">'update'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'PUT'</span><span class="p">,</span>
            <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/analysis/prompt/</span><span class="si">{id}</span><span class="s1">'</span><span class="p">,</span>
            <span class="s1">'body'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'prompt_text'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'output_format'</span><span class="p">:</span> <span class="s1">'Dict[str, str]'</span><span class="p">,</span>
                <span class="s1">'active'</span><span class="p">:</span> <span class="s1">'bool'</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="3-results-management">3. Results Management</h3><p>Handle analysis results:</p><div class="codehilite"><pre><span></span><code><span class="n">results_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'retrieve'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/results'</span><span class="p">,</span>
        <span class="s1">'params'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'search_id'</span><span class="p">:</span> <span class="s1">'Optional[int]'</span><span class="p">,</span>
            <span class="s1">'date_from'</span><span class="p">:</span> <span class="s1">'Optional[str]'</span><span class="p">,</span>
            <span class="s1">'date_to'</span><span class="p">:</span> <span class="s1">'Optional[str]'</span><span class="p">,</span>
            <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'Optional[str]'</span><span class="p">,</span>
            <span class="s1">'page'</span><span class="p">:</span> <span class="s1">'int'</span><span class="p">,</span>
            <span class="s1">'per_page'</span><span class="p">:</span> <span class="s1">'int'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'export'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/results/export'</span><span class="p">,</span>
        <span class="s1">'params'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'format'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>  <span class="c1"># csv, xlsx</span>
            <span class="s1">'fields'</span><span class="p">:</span> <span class="s1">'List[str]'</span><span class="p">,</span>
            <span class="s1">'filters'</span><span class="p">:</span> <span class="s1">'Dict[str, Any]'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Utility Endpoints</button><div class="content"><h3 id="1-health-check">1. Health Check</h3><p>Monitor system status:</p><div class="codehilite"><pre><span></span><code><span class="n">health_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'status'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/health'</span><span class="p">,</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
            <span class="s1">'components'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'database'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'cache'</span><span class="p">:</span> <span class="s1">'str'</span><span class="p">,</span>
                <span class="s1">'external_apis'</span><span class="p">:</span> <span class="s1">'Dict[str, str]'</span>
            <span class="p">},</span>
            <span class="s1">'version'</span><span class="p">:</span> <span class="s1">'str'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-metrics">2. Metrics</h3><p>Monitor system metrics:</p><div class="codehilite"><pre><span></span><code><span class="n">metrics_endpoints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'system'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
        <span class="s1">'url'</span><span class="p">:</span> <span class="s1">'/api/v1/metrics/system'</span><span class="p">,</span>
        <span class="s1">'response'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'cpu_usage'</span><span class="p">:</span> <span class="s1">'float'</span><span class="p">,</span>
            <span class="s1">'memory_usage'</span><span class="p">:</span> <span class="s1">'float'</span><span class="p">,</span>
            <span class="s1">'disk_usage'</span><span class="p">:</span> <span class="s1">'float'</span><span class="p">,</span>
            <span class="s1">'api_latency'</span><span class="p">:</span> <span class="s1">'Dict[str, float]'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="overview.md">API Overview</a></li>
<li><a href="authentication.md">API Authentication</a></li>
<li><a href="examples.md">API Examples</a></li>
<li><a href="../overview/integrations.md">External Integrations</a> </li>
</ul></div>

                </article>
                
                <article id="api-examples">
                    <h1 id="api-examples">API Examples</h1>
<button class="collapsible">Overview</button><div class="content"><p>This guide provides practical examples of:
- Common API workflows
- Integration patterns
- Error handling
- Best practices</p></div>

<button class="collapsible">Search Configuration</button><div class="content"><h3 id="1-create-search-configuration">1. Create Search Configuration</h3><p>Example of setting up a search:</p><div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">create_search_config</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://api.karhuno.com/v1/search/config"</span>

    <span class="c1"># Configuration data</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Warehouse Tech Search"</span><span class="p">,</span>
        <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Search for warehouse automation news"</span><span class="p">,</span>
        <span class="s2">"queries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"warehouse automation"</span><span class="p">,</span>
            <span class="s2">"logistics technology"</span><span class="p">,</span>
            <span class="s2">"storage automation"</span>
        <span class="p">],</span>
        <span class="s2">"filters"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"date_from"</span><span class="p">:</span> <span class="s2">"2024-01-01"</span><span class="p">,</span>
            <span class="s2">"languages"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"en"</span><span class="p">],</span>
            <span class="s2">"regions"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"europe"</span><span class="p">,</span> <span class="s2">"north_america"</span><span class="p">],</span>
            <span class="s2">"exclude_domains"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"competitor1.com"</span><span class="p">,</span> <span class="s2">"competitor2.com"</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">"schedule"</span><span class="p">:</span> <span class="s2">"daily"</span>
    <span class="p">}</span>

    <span class="c1"># Headers with authentication</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"Authorization"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/json"</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error creating search config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div><h3 id="2-start-search-process">2. Start Search Process</h3><p>Execute a configured search:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">execute_search</span><span class="p">(</span><span class="n">config_id</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://api.karhuno.com/v1/search/execute"</span>

    <span class="n">execution_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"config_id"</span><span class="p">:</span> <span class="n">config_id</span><span class="p">,</span>
        <span class="s2">"priority"</span><span class="p">:</span> <span class="s2">"normal"</span><span class="p">,</span>
        <span class="s2">"notify_on_completion"</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">execution_params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">202</span><span class="p">:</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"job_id"</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">monitor_search_progress</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error starting search: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error executing search: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">monitor_search_progress</span><span class="p">(</span><span class="n">job_id</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://api.karhuno.com/v1/search/status/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">"</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"status"</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"completed"</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"results"</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"failed"</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Search failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">'error'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Poll every 5 seconds</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error monitoring search: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></div>






<button class="collapsible">Analysis Configuration</button><div class="content"><h3 id="1-create-analysis-prompt">1. Create Analysis Prompt</h3><p>Set up analysis parameters:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">create_analysis_prompt</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://api.karhuno.com/v1/analysis/prompt"</span>

    <span class="n">prompt_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Warehouse Tech Analysis"</span><span class="p">,</span>
        <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Analyze warehouse automation signals"</span><span class="p">,</span>
        <span class="s2">"prompt_text"</span><span class="p">:</span> <span class="s2">"""</span>
<span class="s2">        Analyze the text for warehouse automation signals.</span>
<span class="s2">        Focus on:</span>
<span class="s2">        - Technology implementation</span>
<span class="s2">        - Automation projects</span>
<span class="s2">        - Efficiency improvements</span>
<span class="s2">        """</span><span class="p">,</span>
        <span class="s2">"output_format"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"str"</span><span class="p">,</span>
            <span class="s2">"signal_strength"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
            <span class="s2">"summary"</span><span class="p">:</span> <span class="s2">"str"</span><span class="p">,</span>
            <span class="s2">"details"</span><span class="p">:</span> <span class="s2">"str"</span>
        <span class="p">},</span>
        <span class="s2">"examples"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"Company X implements new warehouse system..."</span><span class="p">,</span>
                <span class="s2">"output"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"company_name"</span><span class="p">:</span> <span class="s2">"Company X"</span><span class="p">,</span>
                    <span class="s2">"signal_strength"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="s2">"summary"</span><span class="p">:</span> <span class="s2">"Major automation project"</span><span class="p">,</span>
                    <span class="s2">"details"</span><span class="p">:</span> <span class="s2">"Full warehouse system upgrade..."</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">prompt_config</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error creating prompt: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div><h3 id="2-run-analysis">2. Run Analysis</h3><p>Process search results:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">analyze_results</span><span class="p">(</span><span class="n">prompt_id</span><span class="p">,</span> <span class="n">search_results</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">"https://api.karhuno.com/v1/analysis/execute"</span>

    <span class="n">analysis_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"prompt_id"</span><span class="p">:</span> <span class="n">prompt_id</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="n">search_results</span><span class="p">,</span>
        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">"priority"</span><span class="p">:</span> <span class="s2">"normal"</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">analysis_config</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">202</span><span class="p">:</span>
            <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"job_id"</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">monitor_analysis_progress</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error starting analysis: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error executing analysis: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></div>






<button class="collapsible">Results Management</button><div class="content"><h3 id="1-retrieve-results">1. Retrieve Results</h3><p>Get analysis results:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://api.karhuno.com/v1/results/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">"</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"page"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"per_page"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">"min_signal_strength"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="o">**</span><span class="n">filters</span> <span class="k">if</span> <span class="n">filters</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"results"</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error retrieving results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div><h3 id="2-export-results">2. Export Results</h3><p>Export to different formats:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">export_results</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"csv"</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"https://api.karhuno.com/v1/results/export/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">"</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"format"</span><span class="p">:</span> <span class="nb">format</span><span class="p">,</span>
        <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"company_name"</span><span class="p">,</span>
            <span class="s2">"signal_strength"</span><span class="p">,</span>
            <span class="s2">"summary"</span><span class="p">,</span>
            <span class="s2">"details"</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"results.</span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error exporting results: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></div>






<button class="collapsible">Error Handling</button><div class="content"><h3 id="1-robust-request-handler">1. Robust Request Handler</h3><p>Example of robust API interaction:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">make_api_request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">retries</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">backoff_factor</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">'status_code'</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">503</span><span class="p">]:</span>  <span class="c1"># Rate limit or service unavailable</span>
                    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">backoff_factor</span> <span class="o">**</span> <span class="n">attempt</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>  <span class="c1"># Token expired</span>
                    <span class="n">refresh_token</span><span class="p">()</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">'headers'</span><span class="p">][</span><span class="s1">'Authorization'</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">"</span>
                    <span class="k">continue</span>

            <span class="k">raise</span>
</code></pre></div></div>



<button class="collapsible">Complete Workflow</button><div class="content"><h3 id="1-full-process-example">1. Full Process Example</h3><p>Combining all steps:</p><div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">run_analysis_workflow</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create search configuration</span>
        <span class="n">search_config</span> <span class="o">=</span> <span class="n">create_search_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">search_config</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Execute search</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="n">execute_search</span><span class="p">(</span><span class="n">search_config</span><span class="p">[</span><span class="s2">"id"</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">search_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Create analysis prompt</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">create_analysis_prompt</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Run analysis</span>
        <span class="n">analysis_results</span> <span class="o">=</span> <span class="n">analyze_results</span><span class="p">(</span><span class="n">prompt</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span> <span class="n">search_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">analysis_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Export results</span>
        <span class="n">export_results</span><span class="p">(</span><span class="n">analysis_results</span><span class="p">[</span><span class="s2">"job_id"</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"csv"</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Workflow failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></div>



<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="overview.md">API Overview</a></li>
<li><a href="authentication.md">API Authentication</a></li>
<li><a href="endpoints.md">API Endpoints</a></li>
<li><a href="../troubleshooting/common-issues.md">Error Handling</a> </li>
</ul></div>

                </article>
                
            </section>
            
            <section id="deployment">
                <h2>Deployment</h2>
                
                <article id="deployment-setup">
                    <h1 id="system-setup">System Setup</h1>
<button class="collapsible">Overview</button><div class="content"><p>Setting up Karhuno for production requires careful planning because:
- System components are interdependent
- Security must be properly configured
- Performance needs optimization
- Monitoring must be comprehensive</p></div>

<button class="collapsible">Prerequisites</button><div class="content"><h3 id="1-system-requirements">1. System Requirements</h3><p>Hardware and software needs:</p><div class="codehilite"><pre><span></span><code><span class="n">production_requirements</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'hardware'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'application_server'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'cpu'</span><span class="p">:</span> <span class="s1">'4+ cores'</span><span class="p">,</span>
            <span class="s1">'memory'</span><span class="p">:</span> <span class="s1">'16+ GB RAM'</span><span class="p">,</span>
            <span class="s1">'storage'</span><span class="p">:</span> <span class="s1">'100+ GB SSD'</span><span class="p">,</span>
            <span class="s1">'network'</span><span class="p">:</span> <span class="s1">'100+ Mbps'</span>
        <span class="p">},</span>
        <span class="s1">'database_server'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'cpu'</span><span class="p">:</span> <span class="s1">'4+ cores'</span><span class="p">,</span>
            <span class="s1">'memory'</span><span class="p">:</span> <span class="s1">'32+ GB RAM'</span><span class="p">,</span>
            <span class="s1">'storage'</span><span class="p">:</span> <span class="s1">'500+ GB SSD'</span><span class="p">,</span>
            <span class="s1">'network'</span><span class="p">:</span> <span class="s1">'100+ Mbps'</span>
        <span class="p">},</span>
        <span class="s1">'worker_nodes'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'cpu'</span><span class="p">:</span> <span class="s1">'2+ cores per worker'</span><span class="p">,</span>
            <span class="s1">'memory'</span><span class="p">:</span> <span class="s1">'8+ GB RAM per worker'</span><span class="p">,</span>
            <span class="s1">'storage'</span><span class="p">:</span> <span class="s1">'50+ GB SSD per worker'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'software'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'os'</span><span class="p">:</span> <span class="s1">'Ubuntu 20.04 LTS or newer'</span><span class="p">,</span>
        <span class="s1">'python'</span><span class="p">:</span> <span class="s1">'3.11'</span><span class="p">,</span>  <span class="c1"># Strict requirement</span>
        <span class="s1">'postgresql'</span><span class="p">:</span> <span class="s1">'13+'</span><span class="p">,</span>
        <span class="s1">'redis'</span><span class="p">:</span> <span class="s1">'6+'</span><span class="p">,</span>
        <span class="s1">'nginx'</span><span class="p">:</span> <span class="s1">'Latest stable'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-network-requirements">2. Network Requirements</h3><p>Configure network access:</p><div class="codehilite"><pre><span></span><code><span class="n">network_setup</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'firewall_rules'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'inbound'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'80/443 (HTTP/HTTPS)'</span><span class="p">,</span>
            <span class="s1">'5432 (PostgreSQL)'</span><span class="p">,</span>
            <span class="s1">'6379 (Redis)'</span><span class="p">,</span>
            <span class="s1">'8000 (Gunicorn)'</span>
        <span class="p">],</span>
        <span class="s1">'outbound'</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'443 (HTTPS for APIs)'</span><span class="p">,</span>
            <span class="s1">'53 (DNS)'</span><span class="p">,</span>
            <span class="s1">'123 (NTP)'</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">'security_groups'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'web_tier'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'80'</span><span class="p">,</span> <span class="s1">'443'</span><span class="p">],</span>
        <span class="s1">'app_tier'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'8000'</span><span class="p">],</span>
        <span class="s1">'db_tier'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'5432'</span><span class="p">,</span> <span class="s1">'6379'</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Installation Process</button><div class="content"><h3 id="1-base-system-setup">1. Base System Setup</h3><p>Prepare the system:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Update system</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y

<span class="c1"># Add deadsnakes PPA for Python 3.11</span>
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>ppa:deadsnakes/ppa
sudo<span class="w"> </span>apt<span class="w"> </span>update

<span class="c1"># Install system dependencies</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3.11<span class="w"> </span>python3.11-venv<span class="w"> </span>python3.11-dev<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>postgresql-13<span class="w"> </span>redis-server<span class="w"> </span>nginx<span class="w"> </span>supervisor<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>build-essential<span class="w"> </span>libpq-dev

<span class="c1"># Create application user</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/bin/bash<span class="w"> </span>karhuno
sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span>karhuno

<span class="c1"># Create application directory</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/karhuno
sudo<span class="w"> </span>chown<span class="w"> </span>karhuno:karhuno<span class="w"> </span>/opt/karhuno

<span class="c1"># Create log directory</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/karhuno
sudo<span class="w"> </span>chown<span class="w"> </span>karhuno:karhuno<span class="w"> </span>/var/log/karhuno
</code></pre></div><h3 id="2-application-setup">2. Application Setup</h3><p>Install application:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Switch to application user</span>
sudo<span class="w"> </span>su<span class="w"> </span>-<span class="w"> </span>karhuno

<span class="c1"># Clone repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/PavelBelove/karhuno.git<span class="w"> </span>/opt/karhuno
<span class="nb">cd</span><span class="w"> </span>/opt/karhuno

<span class="c1"># Create virtual environment with Python 3.11</span>
python3.11<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate

<span class="c1"># Upgrade pip and install wheel</span>
pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip<span class="w"> </span>wheel<span class="w"> </span>setuptools

<span class="c1"># Install frozen dependencies</span>
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.frozen.txt

<span class="c1"># Install production server packages</span>
pip<span class="w"> </span>install<span class="w"> </span>gunicorn<span class="w"> </span>supervisor
</code></pre></div><h3 id="3-database-setup">3. Database Setup</h3><p>Configure PostgreSQL:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Create database and user</span>
sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">"CREATE DATABASE karhuno;"</span>
sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">"CREATE USER karhuno WITH PASSWORD 'secure_password';"</span>
sudo<span class="w"> </span>-u<span class="w"> </span>postgres<span class="w"> </span>psql<span class="w"> </span>-c<span class="w"> </span><span class="s2">"GRANT ALL PRIVILEGES ON DATABASE karhuno TO karhuno;"</span>

<span class="c1"># Run migrations</span>
flask<span class="w"> </span>db<span class="w"> </span>upgrade
</code></pre></div><h3 id="4-service-configuration">4. Service Configuration</h3><p>Configure services:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Configure Redis</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/opt/karhuno/config/redis.conf<span class="w"> </span>/etc/redis/redis.conf
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>redis

<span class="c1"># Configure Nginx</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/opt/karhuno/config/nginx.conf<span class="w"> </span>/etc/nginx/sites-available/karhuno
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/karhuno<span class="w"> </span>/etc/nginx/sites-enabled/
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx

<span class="c1"># Configure Supervisor</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/opt/karhuno/config/supervisor.conf<span class="w"> </span>/etc/supervisor/conf.d/karhuno.conf
sudo<span class="w"> </span>supervisorctl<span class="w"> </span>reread
sudo<span class="w"> </span>supervisorctl<span class="w"> </span>update
</code></pre></div></div>












<button class="collapsible">Post-Installation</button><div class="content"><h3 id="1-security-setup">1. Security Setup</h3><p>Configure security:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Generate secret key</span>
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">"import secrets; print(secrets.token_hex(32))"</span><span class="w"> </span>&gt;<span class="w"> </span>/opt/karhuno/.env

<span class="c1"># Set up SSL certificates</span>
sudo<span class="w"> </span>certbot<span class="w"> </span>--nginx<span class="w"> </span>-d<span class="w"> </span>your-domain.com

<span class="c1"># Configure firewall</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">80</span>/tcp
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span><span class="m">443</span>/tcp
sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>
</code></pre></div><h3 id="2-monitoring-setup">2. Monitoring Setup</h3><p>Configure monitoring:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Set up logging</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log/karhuno
sudo<span class="w"> </span>chown<span class="w"> </span>karhuno:karhuno<span class="w"> </span>/var/log/karhuno

<span class="c1"># Configure log rotation</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/opt/karhuno/config/logrotate.conf<span class="w"> </span>/etc/logrotate.d/karhuno
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="configuration.md">Configuration Guide</a></li>
<li><a href="security.md">Security Setup</a></li>
<li><a href="monitoring.md">Monitoring Setup</a></li>
<li><a href="../developer/getting-started.md">Development Setup</a></li>
</ul></div>

                </article>
                
                <article id="deployment-configuration">
                    <h1 id="configuration-guide">Configuration Guide</h1>
<button class="collapsible">Overview</button><div class="content"><p>Proper configuration is critical because:
- Multiple components need coordination
- Security settings must be precise
- Performance depends on correct settings
- Different environments need different configs</p></div>

<button class="collapsible">Configuration Files</button><div class="content"><h3 id="1-environment-variables">1. Environment Variables</h3><p>Core system configuration:</p><div class="codehilite"><pre><span></span><code><span class="c1"># Production environment file (.env)</span>
<span class="c1"># Basic Configuration</span>
<span class="nv">FLASK_ENV</span><span class="o">=</span>production
<span class="nv">FLASK_APP</span><span class="o">=</span>run.py
<span class="nv">SECRET_KEY</span><span class="o">=</span>your-generated-key

<span class="c1"># Database Configuration</span>
<span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://karhuno:password@localhost:5432/karhuno
<span class="nv">REDIS_URL</span><span class="o">=</span>redis://localhost:6379/0

<span class="c1"># API Keys</span>
<span class="nv">XMLSTOCK_API_KEY</span><span class="o">=</span>your_api_key
<span class="nv">OPENAI_API_KEY</span><span class="o">=</span>your_api_key

<span class="c1"># Worker Configuration</span>
<span class="nv">CELERY_WORKERS</span><span class="o">=</span><span class="m">4</span>
<span class="nv">GUNICORN_WORKERS</span><span class="o">=</span><span class="m">4</span>

<span class="c1"># Resource Limits</span>
<span class="nv">MAX_CONTENT_LENGTH</span><span class="o">=</span><span class="m">10485760</span><span class="w">  </span><span class="c1"># 10MB</span>
<span class="nv">RATELIMIT_DEFAULT</span><span class="o">=</span><span class="m">300</span>/hour
<span class="nv">RATELIMIT_STORAGE_URL</span><span class="o">=</span>redis://localhost:6379/1
</code></pre></div><h3 id="2-application-configuration">2. Application Configuration</h3><p>Flask application settings:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ProductionConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Production configuration settings.</span>

<span class="sd">    Why these values:</span>
<span class="sd">    - Security first</span>
<span class="sd">    - Resource optimization</span>
<span class="sd">    - Error handling</span>
<span class="sd">    - Performance tuning</span>
<span class="sd">    """</span>

    <span class="c1"># Flask Configuration</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">TESTING</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">SESSION_COOKIE_SECURE</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">REMEMBER_COOKIE_SECURE</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">SESSION_COOKIE_HTTPONLY</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># SQLAlchemy Configuration</span>
    <span class="n">SQLALCHEMY_POOL_SIZE</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">SQLALCHEMY_MAX_OVERFLOW</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">SQLALCHEMY_POOL_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="c1"># Celery Configuration</span>
    <span class="n">CELERY_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'broker_pool_limit'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s1">'result_expires'</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour</span>
        <span class="s1">'task_acks_late'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'task_reject_on_worker_lost'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'worker_prefetch_multiplier'</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>

    <span class="c1"># Cache Configuration</span>
    <span class="n">CACHE_TYPE</span> <span class="o">=</span> <span class="s1">'redis'</span>
    <span class="n">CACHE_REDIS_URL</span> <span class="o">=</span> <span class="s1">'redis://localhost:6379/2'</span>
    <span class="n">CACHE_DEFAULT_TIMEOUT</span> <span class="o">=</span> <span class="mi">300</span>
</code></pre></div><h3 id="3-service-configurations">3. Service Configurations</h3><h4 id="nginx-configuration">Nginx Configuration</h4><p>Web server setup:</p><h1 id="etcnginxsites-availablekarhuno">/etc/nginx/sites-available/karhuno</h1><p>server {
    listen 80;
    server_name your_domain.com;</p><div class="codehilite"><pre><span></span><code><span class="c1"># SSL Configuration</span>
<span class="n">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="n">ssl</span><span class="p">;</span>
<span class="n">ssl_certificate</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="n">your_domain</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">fullchain</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>
<span class="n">ssl_certificate_key</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">/</span><span class="n">live</span><span class="o">/</span><span class="n">your_domain</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">privkey</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>

<span class="c1"># Security Headers</span>
<span class="n">add_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Frame</span><span class="o">-</span><span class="n">Options</span><span class="w"> </span><span class="s2">"SAMEORIGIN"</span><span class="p">;</span>
<span class="n">add_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">XSS</span><span class="o">-</span><span class="n">Protection</span><span class="w"> </span><span class="s2">"1; mode=block"</span><span class="p">;</span>
<span class="n">add_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">-</span><span class="n">Options</span><span class="w"> </span><span class="s2">"nosniff"</span><span class="p">;</span>

<span class="c1"># Application Proxy</span>
<span class="n">location</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">proxy_pass</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="o">$</span><span class="n">host</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Real</span><span class="o">-</span><span class="n">IP</span><span class="w"> </span><span class="o">$</span><span class="n">remote_addr</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span><span class="w"> </span><span class="o">$</span><span class="n">proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">Proto</span><span class="w"> </span><span class="o">$</span><span class="n">scheme</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># WebSocket support</span>
<span class="w">    </span><span class="n">proxy_http_version</span><span class="w"> </span><span class="mf">1.1</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">Upgrade</span><span class="w"> </span><span class="o">$</span><span class="n">http_upgrade</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_set_header</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="s2">"upgrade"</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Timeouts</span>
<span class="w">    </span><span class="n">proxy_connect_timeout</span><span class="w"> </span><span class="mi">60</span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_send_timeout</span><span class="w"> </span><span class="mi">60</span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="n">proxy_read_timeout</span><span class="w"> </span><span class="mi">60</span><span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Static Files</span>
<span class="n">location</span><span class="w"> </span><span class="o">/</span><span class="k">static</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">alias</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">karhuno</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="k">static</span><span class="p">;</span>
<span class="w">    </span><span class="n">expires</span><span class="w"> </span><span class="mi">30</span><span class="n">d</span><span class="p">;</span>
<span class="w">    </span><span class="n">add_header</span><span class="w"> </span><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="w"> </span><span class="s2">"public, no-transform"</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Logging</span>
<span class="n">access_log</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">karhuno_access</span><span class="o">.</span><span class="n">log</span><span class="p">;</span>
<span class="n">error_log</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">karhuno_error</span><span class="o">.</span><span class="n">log</span><span class="p">;</span>
</code></pre></div><p>}</p><h4 id="supervisor-configuration">Supervisor Configuration</h4><p>Process management:</p><p>; /etc/supervisor/conf.d/karhuno.conf</p><p>[program:karhuno_web]
command=/opt/karhuno/venv/bin/gunicorn -w %(ENV_GUNICORN_WORKERS)s -b 127.0.0.1:8000 "app:create_app()"
directory=/opt/karhuno
user=karhuno
autostart=true
autorestart=true
startsecs=5
stopwaitsecs=60
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/karhuno/web.log
stderr_logfile=/var/log/karhuno/web.err
environment=
    FLASK_ENV="production",
    PYTHONPATH="/opt/karhuno"</p><p>[program:karhuno_worker]
command=/opt/karhuno/venv/bin/celery -A app.celery worker --loglevel=info -c %(ENV_CELERY_WORKERS)s
directory=/opt/karhuno
user=karhuno
autostart=true
autorestart=true
startsecs=5
stopwaitsecs=60
stopasgroup=true
killasgroup=true
stdout_logfile=/var/log/karhuno/worker.log
stderr_logfile=/var/log/karhuno/worker.err
environment=
    FLASK_ENV="production",
    PYTHONPATH="/opt/karhuno"</p><h4 id="redis-configuration">Redis Configuration</h4><p>Cache and queue management:</p><h1 id="etcredisredisconf">/etc/redis/redis.conf</h1><h1 id="memory-management">Memory Management</h1><p>maxmemory 8gb
maxmemory-policy allkeys-lru</p><h1 id="persistence">Persistence</h1><p>appendonly yes
appendfsync everysec</p><h1 id="connection">Connection</h1><p>bind 127.0.0.1
protected-mode yes
port 6379</p><h1 id="logging">Logging</h1><p>logfile /var/log/redis/redis.log
loglevel notice</p><h1 id="performance">Performance</h1><p>tcp-keepalive 300
timeout 0
tcp-backlog 511</p><h3 id="4-logging-configuration">4. Logging Configuration</h3><p>System-wide logging setup:</p><h1 id="etclogrotatedkarhuno">/etc/logrotate.d/karhuno</h1><p>/var/log/karhuno/<em>.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 karhuno karhuno
    sharedscripts
    postrotate
        supervisorctl restart karhuno:</em>
    endscript
}</p></div>



































<button class="collapsible">Configuration Management</button><div class="content"><h3 id="1-version-control">1. Version Control</h3><p>Track configuration changes:</p><div class="codehilite"><pre><span></span><code><span class="n">config_management</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'version_control'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'track_configs'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'exclude_secrets'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'backup_before_change'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'deployment'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'use_templates'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'environment_specific'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'validate_before_apply'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'monitoring'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'track_changes'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'alert_on_change'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'audit_trail'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-security-considerations">2. Security Considerations</h3><p>Protect sensitive configuration:</p><div class="codehilite"><pre><span></span><code><span class="n">security_practices</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'secrets_management'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'use_env_vars'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'encrypt_sensitive'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'rotate_regularly'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'access_control'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'restrict_config_access'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'audit_config_changes'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'separate_environments'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'validation'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'check_security_settings'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'validate_ssl_config'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'verify_permissions'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="3-backup-configuration">3. Backup Configuration</h3><p>Configure backup strategy:</p><div class="codehilite"><pre><span></span><code><span class="n">backup_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'database'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'schedule'</span><span class="p">:</span> <span class="s1">'daily'</span><span class="p">,</span>
        <span class="s1">'retention'</span><span class="p">:</span> <span class="s1">'30 days'</span><span class="p">,</span>
        <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'full + incremental'</span><span class="p">,</span>
        <span class="s1">'location'</span><span class="p">:</span> <span class="s1">'secure_backup_server'</span>
    <span class="p">},</span>
    <span class="s1">'configuration'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'schedule'</span><span class="p">:</span> <span class="s1">'on change'</span><span class="p">,</span>
        <span class="s1">'retention'</span><span class="p">:</span> <span class="s1">'last 10 versions'</span><span class="p">,</span>
        <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'full'</span><span class="p">,</span>
        <span class="s1">'location'</span><span class="p">:</span> <span class="s1">'version_control'</span>
    <span class="p">},</span>
    <span class="s1">'logs'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'schedule'</span><span class="p">:</span> <span class="s1">'weekly'</span><span class="p">,</span>
        <span class="s1">'retention'</span><span class="p">:</span> <span class="s1">'90 days'</span><span class="p">,</span>
        <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'compressed'</span><span class="p">,</span>
        <span class="s1">'location'</span><span class="p">:</span> <span class="s1">'log_server'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="setup.md">Setup Guide</a></li>
<li><a href="security.md">Security Setup</a></li>
<li><a href="monitoring.md">Monitoring Setup</a></li>
<li><a href="../overview/architecture.md">System Architecture</a></li>
</ul></div>

                </article>
                
                <article id="deployment-security">
                    <h1 id="security-setup">Security Setup</h1>
<button class="collapsible">Overview</button><div class="content"><p>Security is critical for Karhuno because:
- We handle sensitive business data
- Multiple external API integrations
- Various user access levels
- Distributed system architecture</p></div>

<button class="collapsible">Security Layers</button><div class="content"><h3 id="1-network-security">1. Network Security</h3><p>Configure network protection:</p><div class="codehilite"><pre><span></span><code><span class="n">network_security</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'firewall'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'default_policy'</span><span class="p">:</span> <span class="s1">'deny'</span><span class="p">,</span>
        <span class="s1">'allowed_ports'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'http'</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
            <span class="s1">'https'</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
            <span class="s1">'ssh'</span><span class="p">:</span> <span class="mi">22</span>
        <span class="p">},</span>
        <span class="s1">'rate_limiting'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'ssh_attempts'</span><span class="p">:</span> <span class="s1">'3/minute'</span><span class="p">,</span>
            <span class="s1">'api_requests'</span><span class="p">:</span> <span class="s1">'300/minute'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'ssl'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'protocols'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'TLSv1.2'</span><span class="p">,</span> <span class="s1">'TLSv1.3'</span><span class="p">],</span>
        <span class="s1">'ciphers'</span><span class="p">:</span> <span class="s1">'HIGH:!aNULL:!MD5'</span><span class="p">,</span>
        <span class="s1">'hsts'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'cert_type'</span><span class="p">:</span> <span class="s1">'Let</span><span class="se">\'</span><span class="s1">s Encrypt'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-application-security">2. Application Security</h3><p>Secure application configuration:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SecurityConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Application security settings.</span>

<span class="sd">    Key aspects:</span>
<span class="sd">    1. Authentication</span>
<span class="sd">    2. Authorization</span>
<span class="sd">    3. Session management</span>
<span class="sd">    4. Input validation</span>

<span class="sd">    Why these settings:</span>
<span class="sd">    - Prevent common attacks</span>
<span class="sd">    - Protect user data</span>
<span class="sd">    - Ensure secure communication</span>
<span class="sd">    - Track security events</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">get_security_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get security configuration.</span>

<span class="sd">        Settings explained:</span>
<span class="sd">        - CSRF protection required</span>
<span class="sd">        - Secure session cookies</span>
<span class="sd">        - Strong password policy</span>
<span class="sd">        - Rate limiting enabled</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'auth'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'password_policy'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">'min_length'</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                    <span class="s1">'complexity'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">'max_age'</span><span class="p">:</span> <span class="mi">90</span>
                <span class="p">},</span>
                <span class="s1">'session'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">'timeout'</span><span class="p">:</span> <span class="s1">'30m'</span><span class="p">,</span>
                    <span class="s1">'secure'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">'httponly'</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">},</span>
                <span class="s1">'mfa'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">'required_roles'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">],</span>
                    <span class="s1">'methods'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'totp'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">'api'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'rate_limit'</span><span class="p">:</span> <span class="s1">'300/hour'</span><span class="p">,</span>
                <span class="s1">'token_expiry'</span><span class="p">:</span> <span class="s1">'24h'</span><span class="p">,</span>
                <span class="s1">'require_https'</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div><h3 id="3-data-security">3. Data Security</h3><p>Protect sensitive data:</p><div class="codehilite"><pre><span></span><code><span class="n">data_protection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'encryption'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'at_rest'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'algorithm'</span><span class="p">:</span> <span class="s1">'AES-256-GCM'</span><span class="p">,</span>
            <span class="s1">'key_rotation'</span><span class="p">:</span> <span class="s1">'90 days'</span><span class="p">,</span>
            <span class="s1">'scope'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'database'</span><span class="p">,</span> <span class="s1">'backups'</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s1">'in_transit'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'protocol'</span><span class="p">:</span> <span class="s1">'TLS 1.3'</span><span class="p">,</span>
            <span class="s1">'cert_type'</span><span class="p">:</span> <span class="s1">'Let</span><span class="se">\'</span><span class="s1">s Encrypt'</span><span class="p">,</span>
            <span class="s1">'scope'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'api'</span><span class="p">,</span> <span class="s1">'web'</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'data_classification'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'public'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'company_name'</span><span class="p">,</span> <span class="s1">'industry'</span><span class="p">],</span>
        <span class="s1">'private'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'search_patterns'</span><span class="p">,</span> <span class="s1">'results'</span><span class="p">],</span>
        <span class="s1">'sensitive'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'api_keys'</span><span class="p">,</span> <span class="s1">'credentials'</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Access Control</button><div class="content"><h3 id="1-user-management">1. User Management</h3><p>Configure user access:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AccessControl</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages user access and permissions.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Role-based access</span>
<span class="sd">    2. Permission management</span>
<span class="sd">    3. Access logging</span>
<span class="sd">    4. Session control</span>

<span class="sd">    Example:</span>
<span class="sd">        control = AccessControl()</span>
<span class="sd">        roles = control.get_role_config()</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">get_role_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Define role permissions.</span>

<span class="sd">        Roles:</span>
<span class="sd">        - Admin: Full access</span>
<span class="sd">        - Analyst: Data management</span>
<span class="sd">        - Client: View results</span>
<span class="sd">        - API: Limited access</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'admin'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'all'</span><span class="p">],</span>
            <span class="s1">'analyst'</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">'manage_prompts'</span><span class="p">,</span>
                <span class="s1">'review_results'</span><span class="p">,</span>
                <span class="s1">'export_data'</span>
            <span class="p">],</span>
            <span class="s1">'client'</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">'view_results'</span><span class="p">,</span>
                <span class="s1">'download_reports'</span>
            <span class="p">],</span>
            <span class="s1">'api'</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">'submit_search'</span><span class="p">,</span>
                <span class="s1">'get_results'</span>
            <span class="p">]</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-api-security">2. API Security</h3><p>Secure API access:</p><div class="codehilite"><pre><span></span><code><span class="n">api_security</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'authentication'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'method'</span><span class="p">:</span> <span class="s1">'Bearer token'</span><span class="p">,</span>
        <span class="s1">'token_type'</span><span class="p">:</span> <span class="s1">'JWT'</span><span class="p">,</span>
        <span class="s1">'expiration'</span><span class="p">:</span> <span class="s1">'24h'</span><span class="p">,</span>
        <span class="s1">'refresh'</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">},</span>
    <span class="s1">'rate_limiting'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'default'</span><span class="p">:</span> <span class="s1">'300/hour'</span><span class="p">,</span>
        <span class="s1">'burst'</span><span class="p">:</span> <span class="s1">'50/minute'</span><span class="p">,</span>
        <span class="s1">'cleanup'</span><span class="p">:</span> <span class="s1">'1h'</span>
    <span class="p">},</span>
    <span class="s1">'monitoring'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'log_level'</span><span class="p">:</span> <span class="s1">'INFO'</span><span class="p">,</span>
        <span class="s1">'track_usage'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">'alert_threshold'</span><span class="p">:</span> <span class="s1">'80%'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Monitoring and Auditing</button><div class="content"><h3 id="1-security-monitoring">1. Security Monitoring</h3><p>Configure security monitoring:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SecurityMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Monitors security-related events.</span>

<span class="sd">    What to monitor:</span>
<span class="sd">    1. Authentication attempts</span>
<span class="sd">    2. Permission changes</span>
<span class="sd">    3. Configuration updates</span>
<span class="sd">    4. API usage patterns</span>

<span class="sd">    Why monitor:</span>
<span class="sd">    - Detect threats</span>
<span class="sd">    - Track changes</span>
<span class="sd">    - Ensure compliance</span>
<span class="sd">    - Investigate incidents</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">get_monitoring_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get monitoring configuration.</span>

<span class="sd">        Monitoring areas:</span>
<span class="sd">        - Access attempts</span>
<span class="sd">        - System changes</span>
<span class="sd">        - API usage</span>
<span class="sd">        - Error patterns</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'logging'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'security_events'</span><span class="p">:</span> <span class="s1">'INFO'</span><span class="p">,</span>
                <span class="s1">'auth_attempts'</span><span class="p">:</span> <span class="s1">'INFO'</span><span class="p">,</span>
                <span class="s1">'api_access'</span><span class="p">:</span> <span class="s1">'INFO'</span><span class="p">,</span>
                <span class="s1">'changes'</span><span class="p">:</span> <span class="s1">'INFO'</span>
            <span class="p">},</span>
            <span class="s1">'alerts'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'failed_auth'</span><span class="p">:</span> <span class="s1">'5/minute'</span><span class="p">,</span>
                <span class="s1">'api_errors'</span><span class="p">:</span> <span class="s1">'10/minute'</span><span class="p">,</span>
                <span class="s1">'config_changes'</span><span class="p">:</span> <span class="s1">'any'</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-audit-trail">2. Audit Trail</h3><p>Configure audit logging:</p><div class="codehilite"><pre><span></span><code><span class="n">audit_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'events'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'user_access'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'login'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'logout'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'failed_attempts'</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">'data_access'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'view'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'export'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'modify'</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">'system_changes'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'configuration'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'permissions'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">'api_keys'</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'retention'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'audit_logs'</span><span class="p">:</span> <span class="s1">'365 days'</span><span class="p">,</span>
        <span class="s1">'access_logs'</span><span class="p">:</span> <span class="s1">'90 days'</span><span class="p">,</span>
        <span class="s1">'security_events'</span><span class="p">:</span> <span class="s1">'180 days'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="configuration.md">Configuration Guide</a></li>
<li><a href="monitoring.md">Monitoring Setup</a></li>
<li><a href="../security/access-control.md">Access Control</a></li>
<li><a href="../security/incidents.md">Incident Response</a> </li>
</ul></div>

                </article>
                
                <article id="deployment-monitoring">
                    <h1 id="monitoring-setup">Monitoring Setup</h1>
<button class="collapsible">Overview</button><div class="content"><p>Monitoring is essential for Karhuno because:
- Multiple system components need tracking
- Performance affects analysis quality
- Resource usage impacts costs
- Early problem detection is critical</p></div>

<button class="collapsible">Monitoring Components</button><div class="content"><h3 id="1-system-metrics">1. System Metrics</h3><p>Track system performance:</p><div class="codehilite"><pre><span></span><code><span class="n">system_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'resources'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'cpu'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'usage_percent'</span><span class="p">:</span> <span class="s1">'Per process'</span><span class="p">,</span>
            <span class="s1">'load_average'</span><span class="p">:</span> <span class="s1">'1m, 5m, 15m'</span><span class="p">,</span>
            <span class="s1">'alert_threshold'</span><span class="p">:</span> <span class="s1">'80%'</span>
        <span class="p">},</span>
        <span class="s1">'memory'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'usage_percent'</span><span class="p">:</span> <span class="s1">'Per process'</span><span class="p">,</span>
            <span class="s1">'available'</span><span class="p">:</span> <span class="s1">'System-wide'</span><span class="p">,</span>
            <span class="s1">'alert_threshold'</span><span class="p">:</span> <span class="s1">'85%'</span>
        <span class="p">},</span>
        <span class="s1">'disk'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'usage_percent'</span><span class="p">:</span> <span class="s1">'Per mount'</span><span class="p">,</span>
            <span class="s1">'io_stats'</span><span class="p">:</span> <span class="s1">'Read/Write'</span><span class="p">,</span>
            <span class="s1">'alert_threshold'</span><span class="p">:</span> <span class="s1">'90%'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'network'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'bandwidth'</span><span class="p">:</span> <span class="s1">'In/Out per interface'</span><span class="p">,</span>
        <span class="s1">'connections'</span><span class="p">:</span> <span class="s1">'Active/Total'</span><span class="p">,</span>
        <span class="s1">'latency'</span><span class="p">:</span> <span class="s1">'Per endpoint'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-application-metrics">2. Application Metrics</h3><p>Monitor application performance:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ApplicationMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Monitors application performance.</span>

<span class="sd">    Key metrics:</span>
<span class="sd">    1. Response times</span>
<span class="sd">    2. Error rates</span>
<span class="sd">    3. Request volumes</span>
<span class="sd">    4. Queue lengths</span>

<span class="sd">    Why monitor:</span>
<span class="sd">    - Track user experience</span>
<span class="sd">    - Identify bottlenecks</span>
<span class="sd">    - Plan capacity</span>
<span class="sd">    - Detect issues</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">get_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get application metrics.</span>

<span class="sd">        Metrics include:</span>
<span class="sd">        - API response times</span>
<span class="sd">        - Database query times</span>
<span class="sd">        - Cache hit rates</span>
<span class="sd">        - Error frequencies</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'web'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'response_time'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response_stats</span><span class="p">(),</span>
                <span class="s1">'error_rate'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_error_stats</span><span class="p">(),</span>
                <span class="s1">'active_users'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_count</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s1">'api'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'requests_per_minute'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request_rate</span><span class="p">(),</span>
                <span class="s1">'average_latency'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_latency_stats</span><span class="p">(),</span>
                <span class="s1">'error_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_errors</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div><h3 id="3-process-monitoring">3. Process Monitoring</h3><p>Track worker processes:</p><div class="codehilite"><pre><span></span><code><span class="n">process_monitoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'celery'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'workers'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'active_tasks'</span><span class="p">:</span> <span class="s1">'Current count'</span><span class="p">,</span>
            <span class="s1">'queue_length'</span><span class="p">:</span> <span class="s1">'Pending tasks'</span><span class="p">,</span>
            <span class="s1">'processing_time'</span><span class="p">:</span> <span class="s1">'Per task'</span>
        <span class="p">},</span>
        <span class="s1">'queues'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'size'</span><span class="p">:</span> <span class="s1">'Per queue'</span><span class="p">,</span>
            <span class="s1">'throughput'</span><span class="p">:</span> <span class="s1">'Tasks/minute'</span><span class="p">,</span>
            <span class="s1">'latency'</span><span class="p">:</span> <span class="s1">'Queue time'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'gunicorn'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'workers'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'count'</span><span class="p">:</span> <span class="s1">'Active workers'</span><span class="p">,</span>
            <span class="s1">'requests'</span><span class="p">:</span> <span class="s1">'Per worker'</span><span class="p">,</span>
            <span class="s1">'memory'</span><span class="p">:</span> <span class="s1">'Per worker'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>









<button class="collapsible">Performance Tracking</button><div class="content"><h3 id="1-database-monitoring">1. Database Monitoring</h3><p>Track database performance:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DatabaseMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Monitors database performance.</span>

<span class="sd">    What to monitor:</span>
<span class="sd">    1. Query performance</span>
<span class="sd">    2. Connection usage</span>
<span class="sd">    3. Cache efficiency</span>
<span class="sd">    4. Resource usage</span>

<span class="sd">    Why important:</span>
<span class="sd">    - Often the bottleneck</span>
<span class="sd">    - Critical for scaling</span>
<span class="sd">    - Impact on response time</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">get_db_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get database metrics.</span>

<span class="sd">        Key areas:</span>
<span class="sd">        - Query times</span>
<span class="sd">        - Connection pools</span>
<span class="sd">        - Cache hits</span>
<span class="sd">        - Lock waits</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'performance'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'query_time'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_query_stats</span><span class="p">(),</span>
                <span class="s1">'connection_usage'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_connection_stats</span><span class="p">(),</span>
                <span class="s1">'cache_hit_ratio'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cache_stats</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s1">'resources'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'cpu_usage'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cpu_stats</span><span class="p">(),</span>
                <span class="s1">'memory_usage'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_memory_stats</span><span class="p">(),</span>
                <span class="s1">'disk_io'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_io_stats</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-api-monitoring">2. API Monitoring</h3><p>Track external API usage:</p><div class="codehilite"><pre><span></span><code><span class="n">api_monitoring</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'xmlstock'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'requests'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'success_rate'</span><span class="p">:</span> <span class="s1">'Percentage'</span><span class="p">,</span>
            <span class="s1">'error_types'</span><span class="p">:</span> <span class="s1">'Categorized'</span><span class="p">,</span>
            <span class="s1">'response_time'</span><span class="p">:</span> <span class="s1">'Average'</span>
        <span class="p">},</span>
        <span class="s1">'limits'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'usage'</span><span class="p">:</span> <span class="s1">'Current/Total'</span><span class="p">,</span>
            <span class="s1">'reset_time'</span><span class="p">:</span> <span class="s1">'Next reset'</span><span class="p">,</span>
            <span class="s1">'remaining'</span><span class="p">:</span> <span class="s1">'Available calls'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'openai'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'usage'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'tokens'</span><span class="p">:</span> <span class="s1">'Used/Limit'</span><span class="p">,</span>
            <span class="s1">'cost'</span><span class="p">:</span> <span class="s1">'Per request'</span><span class="p">,</span>
            <span class="s1">'models'</span><span class="p">:</span> <span class="s1">'Usage by model'</span>
        <span class="p">},</span>
        <span class="s1">'performance'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'latency'</span><span class="p">:</span> <span class="s1">'Response time'</span><span class="p">,</span>
            <span class="s1">'success_rate'</span><span class="p">:</span> <span class="s1">'Completion rate'</span><span class="p">,</span>
            <span class="s1">'error_types'</span><span class="p">:</span> <span class="s1">'Categorized'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Alerting System</button><div class="content"><h3 id="1-alert-configuration">1. Alert Configuration</h3><p>Configure monitoring alerts:</p><div class="codehilite"><pre><span></span><code><span class="n">alert_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'severity_levels'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'critical'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'response_time'</span><span class="p">:</span> <span class="s1">'Immediate'</span><span class="p">,</span>
            <span class="s1">'notification'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'email'</span><span class="p">,</span> <span class="s1">'sms'</span><span class="p">,</span> <span class="s1">'slack'</span><span class="p">],</span>
            <span class="s1">'auto_actions'</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">'warning'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'response_time'</span><span class="p">:</span> <span class="s1">'15m'</span><span class="p">,</span>
            <span class="s1">'notification'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'email'</span><span class="p">,</span> <span class="s1">'slack'</span><span class="p">],</span>
            <span class="s1">'auto_actions'</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">},</span>
        <span class="s1">'info'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'response_time'</span><span class="p">:</span> <span class="s1">'1h'</span><span class="p">,</span>
            <span class="s1">'notification'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'email'</span><span class="p">],</span>
            <span class="s1">'auto_actions'</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">'thresholds'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'system'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'cpu'</span><span class="p">:</span> <span class="s1">'80%'</span><span class="p">,</span>
            <span class="s1">'memory'</span><span class="p">:</span> <span class="s1">'85%'</span><span class="p">,</span>
            <span class="s1">'disk'</span><span class="p">:</span> <span class="s1">'90%'</span>
        <span class="p">},</span>
        <span class="s1">'application'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'error_rate'</span><span class="p">:</span> <span class="s1">'5%'</span><span class="p">,</span>
            <span class="s1">'response_time'</span><span class="p">:</span> <span class="s1">'2s'</span><span class="p">,</span>
            <span class="s1">'queue_length'</span><span class="p">:</span> <span class="mi">1000</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-response-procedures">2. Response Procedures</h3><p>Define alert responses:</p><div class="codehilite"><pre><span></span><code><span class="n">response_procedures</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'high_load'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Check system metrics'</span><span class="p">,</span>
        <span class="s1">'Identify bottlenecks'</span><span class="p">,</span>
        <span class="s1">'Scale resources if needed'</span><span class="p">,</span>
        <span class="s1">'Review recent changes'</span>
    <span class="p">],</span>
    <span class="s1">'high_error_rate'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Check error logs'</span><span class="p">,</span>
        <span class="s1">'Identify error patterns'</span><span class="p">,</span>
        <span class="s1">'Review recent deployments'</span><span class="p">,</span>
        <span class="s1">'Consider rollback'</span>
    <span class="p">],</span>
    <span class="s1">'api_issues'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Check API status'</span><span class="p">,</span>
        <span class="s1">'Review rate limits'</span><span class="p">,</span>
        <span class="s1">'Check credentials'</span><span class="p">,</span>
        <span class="s1">'Switch to backup if available'</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="../performance/metrics.md">Performance Metrics</a></li>
<li><a href="configuration.md">System Configuration</a></li>
<li><a href="../troubleshooting/index.md">Troubleshooting Guide</a></li>
<li><a href="../performance/scaling.md">Scaling Guide</a> </li>
</ul></div>

                </article>
                
            </section>
            
            <section id="performance">
                <h2>Performance</h2>
                
                <article id="performance-metrics">
                    <h1 id="performance-metrics">Performance Metrics</h1>
<button class="collapsible">Overview</button><div class="content"><p>Performance metrics in Karhuno are case-specific and focus on:
- Processing efficiency
- Signal quality
- System scalability</p></div>

<button class="collapsible">Processing Metrics</button><div class="content"><h3 id="1-collection-performance">1. Collection Performance</h3><div class="codehilite"><pre><span></span><code><span class="n">collection_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'raw_signals'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'target'</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>  <span class="c1"># signals per collection</span>
        <span class="s1">'time_limit'</span><span class="p">:</span> <span class="s1">'30m'</span><span class="p">,</span>  <span class="c1"># maximum collection time</span>
        <span class="s1">'parallel_processes'</span><span class="p">:</span> <span class="mi">4</span>  <span class="c1"># concurrent collectors</span>
    <span class="p">},</span>
    <span class="s1">'filtering_stats'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'unparseable_rate'</span><span class="p">:</span> <span class="s1">'failed_parse / total_collected'</span><span class="p">,</span>
        <span class="s1">'duplicate_rate'</span><span class="p">:</span> <span class="s1">'duplicates / total_collected'</span><span class="p">,</span>
        <span class="s1">'clean_signals'</span><span class="p">:</span> <span class="s1">'valid_signals / total_collected'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-cleaning-performance">2. Cleaning Performance</h3><p>Different cleaning strategies for different sources:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CleaningMetrics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Tracks cleaning performance by source type.</span>

<span class="sd">    Key aspects:</span>
<span class="sd">    1. Source-specific deduplication</span>
<span class="sd">    2. Content extraction success</span>
<span class="sd">    3. Processing speed</span>

<span class="sd">    Example:</span>
<span class="sd">        metrics = CleaningMetrics()</span>
<span class="sd">        job_stats = metrics.get_stats('job_boards')</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">get_cleaning_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get source-specific cleaning metrics.</span>

<span class="sd">        Strategies:</span>
<span class="sd">        - Job boards: URL-based deduplication only</span>
<span class="sd">        - News: Content similarity check</span>
<span class="sd">        - Social media: Mixed approach</span>
<span class="sd">        """</span>
        <span class="n">strategies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'job_boards'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'dedup_method'</span><span class="p">:</span> <span class="s1">'strict_url'</span><span class="p">,</span>
                <span class="s1">'content_check'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">'similarity_threshold'</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">},</span>
            <span class="s1">'news'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'dedup_method'</span><span class="p">:</span> <span class="s1">'content_similarity'</span><span class="p">,</span>
                <span class="s1">'content_check'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">'similarity_threshold'</span><span class="p">:</span> <span class="mf">0.85</span>
            <span class="p">},</span>
            <span class="s1">'social'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">'dedup_method'</span><span class="p">:</span> <span class="s1">'mixed'</span><span class="p">,</span>
                <span class="s1">'content_check'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">'similarity_threshold'</span><span class="p">:</span> <span class="mf">0.75</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">strategies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="p">{})</span>
</code></pre></div></div>





<button class="collapsible">Quality Metrics</button><div class="content"><h3 id="1-signal-quality">1. Signal Quality</h3><p>Case-specific quality assessment:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SignalQualityMetrics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Tracks signal quality metrics.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Case-specific benchmarking</span>
<span class="sd">    2. Historical comparison</span>
<span class="sd">    3. Enriched sampling</span>

<span class="sd">    Example:</span>
<span class="sd">        metrics = SignalQualityMetrics(case_type='warehouse_tech')</span>
<span class="sd">        quality = metrics.analyze_batch(signals)</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">analyze_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                     <span class="n">signals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                     <span class="n">enriched_sample</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Analyze signal batch quality.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Compare with similar cases</span>
<span class="sd">        2. Check historical performance</span>
<span class="sd">        3. Evaluate enriched samples</span>

<span class="sd">        Args:</span>
<span class="sd">            signals: Processed signals</span>
<span class="sd">            enriched_sample: Known good signals mixed in</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'approval_rate'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_approval_rate</span><span class="p">(</span><span class="n">signals</span><span class="p">),</span>
            <span class="s1">'historical_comparison'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_historical</span><span class="p">(),</span>
            <span class="s1">'enriched_accuracy'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_enriched</span><span class="p">(</span><span class="n">enriched_sample</span><span class="p">)</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-prompt-performance">2. Prompt Performance</h3><p>Evaluate prompt effectiveness:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PromptEvaluation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Evaluates prompt performance using enriched samples.</span>

<span class="sd">    Method:</span>
<span class="sd">    1. Mix known signals (30% of batch)</span>
<span class="sd">    2. Run analysis</span>
<span class="sd">    3. Compare results</span>

<span class="sd">    Example:</span>
<span class="sd">        evaluator = PromptEvaluation(prompt_id='warehouse_v2')</span>
<span class="sd">        results = await evaluator.test_prompt()</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">test_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                         <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
                         <span class="n">known_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Test prompt with enriched sample.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Prepare mixed sample</span>
<span class="sd">        2. Run analysis</span>
<span class="sd">        3. Calculate metrics</span>

<span class="sd">        Args:</span>
<span class="sd">            sample_size: Total sample size</span>
<span class="sd">            known_ratio: Ratio of known good signals</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'detection_rate'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_detection_rate</span><span class="p">(),</span>
            <span class="s1">'false_positive_rate'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_false_positives</span><span class="p">(),</span>
            <span class="s1">'processing_efficiency'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_efficiency</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Scalability Metrics</button><div class="content"><h3 id="1-parallel-processing">1. Parallel Processing</h3><p>Measure parallel processing efficiency:</p><div class="codehilite"><pre><span></span><code><span class="n">parallel_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'collection'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'optimal_workers'</span><span class="p">:</span> <span class="s1">'workers at peak efficiency'</span><span class="p">,</span>
        <span class="s1">'throughput'</span><span class="p">:</span> <span class="s1">'signals per minute'</span><span class="p">,</span>
        <span class="s1">'resource_usage'</span><span class="p">:</span> <span class="s1">'CPU/memory per worker'</span>
    <span class="p">},</span>
    <span class="s1">'analysis'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'batch_size'</span><span class="p">:</span> <span class="s1">'optimal items per batch'</span><span class="p">,</span>
        <span class="s1">'concurrent_tasks'</span><span class="p">:</span> <span class="s1">'optimal concurrent analyses'</span><span class="p">,</span>
        <span class="s1">'token_efficiency'</span><span class="p">:</span> <span class="s1">'tokens per signal'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-case-comparison">2. Case Comparison</h3><p>Compare similar cases:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CaseComparison</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Compares performance across similar cases.</span>

<span class="sd">    Metrics:</span>
<span class="sd">    1. Signal yield (good signals per 1000)</span>
<span class="sd">    2. Processing efficiency</span>
<span class="sd">    3. Resource usage</span>

<span class="sd">    Example:</span>
<span class="sd">        comparison = CaseComparison(case_type='facility_signals')</span>
<span class="sd">        metrics = comparison.compare_cases(['warehouse', 'office'])</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">normalize_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">case_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Normalize metrics for case comparison.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Adjust for case specifics</span>
<span class="sd">        2. Calculate relative performance</span>
<span class="sd">        3. Generate recommendations</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'relative_yield'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_relative_yield</span><span class="p">(),</span>
            <span class="s1">'efficiency_score'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_efficiency_score</span><span class="p">(),</span>
            <span class="s1">'improvement_potential'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_improvement</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="optimization.md">Performance Optimization</a></li>
<li><a href="scaling.md">System Scaling</a></li>
<li><a href="../best-practices/quality-control.md">Quality Control</a></li>
<li><a href="../business-processes/analysis-process.md">Analysis Process</a> </li>
</ul></div>

                </article>
                
                <article id="performance-optimization">
                    <h1 id="performance-optimization">Performance Optimization</h1>
<button class="collapsible">Overview</button><div class="content"><p>Performance optimization in Karhuno focuses on three key areas:
- Processing speed and efficiency
- Signal quality improvement
- Resource utilization</p><p>Understanding optimization is crucial because:
- Processing thousands of signals requires efficient resource use
- API costs can grow quickly without proper optimization
- Analysis quality depends on optimal token usage
- System responsiveness affects analyst productivity</p></div>


<button class="collapsible">Collection Optimization</button><div class="content"><h3 id="1-parallel-collection">1. Parallel Collection</h3><p>When collecting data from multiple sources, parallel processing is essential. Without it, sequential processing of 1000 URLs might take hours instead of minutes.</p><p>For example:
- Sequential: 1000 URLs × 2s per URL = 2000s (33 minutes)
- Parallel (4 workers): 2000s ÷ 4 = 500s (8 minutes)</p><p>Here's how we optimize collection:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CollectionOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes data collection process.</span>

<span class="sd">    Key features:</span>
<span class="sd">    1. Dynamic worker scaling - adjusts based on system load</span>
<span class="sd">    2. Source prioritization - important sources processed first</span>
<span class="sd">    3. Rate limit management - prevents API blocks</span>
<span class="sd">    4. Resource balancing - prevents system overload</span>

<span class="sd">    Why this matters:</span>
<span class="sd">    - Faster collection = more frequent updates</span>
<span class="sd">    - Proper rate limiting = reliable service</span>
<span class="sd">    - Resource balancing = stable system</span>

<span class="sd">    Example:</span>
<span class="sd">        optimizer = CollectionOptimizer(max_workers=8)</span>
<span class="sd">        config = await optimizer.optimize_collection()</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">optimize_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize collection parameters.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Monitor system resources</span>
<span class="sd">        2. Adjust worker count</span>
<span class="sd">        3. Balance API usage</span>
<span class="sd">        4. Manage rate limits</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optimized collection configuration</span>
<span class="sd">        """</span>
        <span class="n">current_load</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_system_load</span><span class="p">()</span>
        <span class="n">optimal_workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_optimal_workers</span><span class="p">(</span><span class="n">current_load</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'worker_count'</span><span class="p">:</span> <span class="n">optimal_workers</span><span class="p">,</span>
            <span class="s1">'batch_size'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_optimal_batch_size</span><span class="p">(),</span>
            <span class="s1">'rate_limits'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_rate_limits</span><span class="p">(),</span>
            <span class="s1">'source_priorities'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_source_priorities</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-source-management">2. Source Management</h3><p>Optimize source utilization:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SourceOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes source usage and priorities.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Source effectiveness tracking</span>
<span class="sd">    2. Priority adjustment</span>
<span class="sd">    3. Cost optimization</span>
<span class="sd">    4. Coverage management</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">optimize_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">performance_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize source configuration.</span>

<span class="sd">        Strategy:</span>
<span class="sd">        - Prioritize high-yield sources</span>
<span class="sd">        - Adjust polling frequencies</span>
<span class="sd">        - Balance cost vs. benefit</span>
<span class="sd">        - Maintain coverage requirements</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'source_weights'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_weights</span><span class="p">(),</span>
            <span class="s1">'polling_intervals'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_intervals</span><span class="p">(),</span>
            <span class="s1">'cost_efficiency'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_costs</span><span class="p">(),</span>
            <span class="s1">'coverage_stats'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_coverage</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>








<button class="collapsible">Analysis Optimization</button><div class="content"><h3 id="1-batch-processing">1. Batch Processing</h3><p>Optimize batch sizes for different stages:</p><div class="codehilite"><pre><span></span><code><span class="n">batch_optimization</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'cleaning'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'optimal_size'</span><span class="p">:</span> <span class="s1">'Based on memory usage'</span><span class="p">,</span>
        <span class="s1">'grouping_strategy'</span><span class="p">:</span> <span class="s1">'By source type'</span><span class="p">,</span>
        <span class="s1">'parallel_processing'</span><span class="p">:</span> <span class="s1">'Source-dependent'</span>
    <span class="p">},</span>
    <span class="s1">'analysis'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'optimal_size'</span><span class="p">:</span> <span class="s1">'Based on token limits'</span><span class="p">,</span>
        <span class="s1">'context_management'</span><span class="p">:</span> <span class="s1">'Shared context per batch'</span><span class="p">,</span>
        <span class="s1">'error_handling'</span><span class="p">:</span> <span class="s1">'Per-item recovery'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-token-usage">2. Token Usage</h3><p>Optimize LLM token usage:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TokenOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes token usage in LLM processing.</span>

<span class="sd">    Strategies:</span>
<span class="sd">    1. Content truncation</span>
<span class="sd">    2. Context optimization</span>
<span class="sd">    3. Batch size adjustment</span>
<span class="sd">    4. Response format efficiency</span>

<span class="sd">    Note: Balance between completeness and token usage</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">optimize_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize content for token efficiency.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Remove redundant information</span>
<span class="sd">        2. Preserve key details</span>
<span class="sd">        3. Structure for efficiency</span>
<span class="sd">        4. Maintain readability</span>
<span class="sd">        """</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_redundant</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="n">structured</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_structure</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_if_needed</span><span class="p">(</span><span class="n">structured</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">)</span>
</code></pre></div></div>






<button class="collapsible">Resource Optimization</button><div class="content"><h3 id="1-memory-management">1. Memory Management</h3><p>Optimize memory usage:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MemoryOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes memory usage across processes.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Streaming processing</span>
<span class="sd">    2. Garbage collection</span>
<span class="sd">    3. Cache management</span>
<span class="sd">    4. Buffer optimization</span>

<span class="sd">    Example:</span>
<span class="sd">        optimizer = MemoryOptimizer()</span>
<span class="sd">        await optimizer.optimize_process()</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">optimize_process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize process memory usage.</span>

<span class="sd">        Steps:</span>
<span class="sd">        1. Monitor memory patterns</span>
<span class="sd">        2. Adjust buffer sizes</span>
<span class="sd">        3. Manage cache</span>
<span class="sd">        4. Schedule cleanup</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'buffer_sizes'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_buffers</span><span class="p">(),</span>
            <span class="s1">'cache_config'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_cache</span><span class="p">(),</span>
            <span class="s1">'gc_schedule'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_cleanup</span><span class="p">(),</span>
            <span class="s1">'memory_limits'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_limits</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-cpu-utilization">2. CPU Utilization</h3><p>Balance CPU usage:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CPUOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes CPU utilization.</span>

<span class="sd">    Strategies:</span>
<span class="sd">    1. Load balancing</span>
<span class="sd">    2. Process scheduling</span>
<span class="sd">    3. Priority management</span>
<span class="sd">    4. Resource allocation</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">optimize_cpu_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize CPU resource usage.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Monitor CPU patterns</span>
<span class="sd">        2. Adjust process priorities</span>
<span class="sd">        3. Balance workloads</span>
<span class="sd">        4. Manage concurrency</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'process_priorities'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_priorities</span><span class="p">(),</span>
            <span class="s1">'worker_allocation'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_workers</span><span class="p">(),</span>
            <span class="s1">'concurrency_limits'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_limits</span><span class="p">(),</span>
            <span class="s1">'scheduling_rules'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_define_rules</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Cost Optimization</button><div class="content"><h3 id="1-api-usage">1. API Usage</h3><p>Optimize external API costs:</p><div class="codehilite"><pre><span></span><code><span class="n">api_optimization</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'xmlstock'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'caching'</span><span class="p">:</span> <span class="s1">'Aggressive for frequent queries'</span><span class="p">,</span>
        <span class="s1">'batch_size'</span><span class="p">:</span> <span class="s1">'Optimal for rate limits'</span><span class="p">,</span>
        <span class="s1">'retry_strategy'</span><span class="p">:</span> <span class="s1">'Exponential backoff'</span>
    <span class="p">},</span>
    <span class="s1">'llm'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'token_optimization'</span><span class="p">:</span> <span class="s1">'Content truncation'</span><span class="p">,</span>
        <span class="s1">'batch_processing'</span><span class="p">:</span> <span class="s1">'Context sharing'</span><span class="p">,</span>
        <span class="s1">'model_selection'</span><span class="p">:</span> <span class="s1">'Cost vs. capability'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="2-resource-allocation">2. Resource Allocation</h3><p>Optimize resource allocation:</p><div class="codehilite"><pre><span></span><code><span class="n">resource_optimization</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'compute'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'scaling_rules'</span><span class="p">:</span> <span class="s1">'Load-based'</span><span class="p">,</span>
        <span class="s1">'instance_types'</span><span class="p">:</span> <span class="s1">'Workload-specific'</span><span class="p">,</span>
        <span class="s1">'scheduling'</span><span class="p">:</span> <span class="s1">'Usage patterns'</span>
    <span class="p">},</span>
    <span class="s1">'storage'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'retention_policy'</span><span class="p">:</span> <span class="s1">'Age-based cleanup'</span><span class="p">,</span>
        <span class="s1">'compression'</span><span class="p">:</span> <span class="s1">'Type-specific'</span><span class="p">,</span>
        <span class="s1">'tiering'</span><span class="p">:</span> <span class="s1">'Access patterns'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="metrics.md">Performance Metrics</a></li>
<li><a href="scaling.md">System Scaling</a></li>
<li><a href="../deployment/resources.md">Resource Management</a></li>
<li><a href="../deployment/costs.md">Cost Management</a> </li>
</ul></div>

                </article>
                
                <article id="performance-scaling">
                    <h1 id="system-scaling">System Scaling</h1>
<button class="collapsible">Overview</button><div class="content"><p>Scaling in Karhuno addresses three main challenges:
1. Growing number of clients (each adding 20-50 search queries)
2. Increasing data volume (thousands of results per client)
3. Complex analysis requirements (LLM processing)</p><p>Why scaling matters:
- More clients = more concurrent tasks
- Larger data volume = higher resource needs
- Complex analysis = higher processing demands</p></div>


<button class="collapsible">Scaling Strategies</button><div class="content"><h3 id="1-horizontal-scaling">1. Horizontal Scaling</h3><p>Adding more processing power by increasing the number of workers:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">WorkerManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages worker scaling across system components.</span>

<span class="sd">    Why we need this:</span>
<span class="sd">    - Single worker can't handle all clients</span>
<span class="sd">    - Different tasks need different resources</span>
<span class="sd">    - System load varies throughout day</span>

<span class="sd">    Example:</span>
<span class="sd">        manager = WorkerManager()</span>
<span class="sd">        await manager.scale_workers(load_increase=1.5)</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">scale_workers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                          <span class="n">load_increase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                          <span class="n">component</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'all'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Scale workers based on load.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Check current load</span>
<span class="sd">        2. Calculate needed workers</span>
<span class="sd">        3. Start/stop workers</span>
<span class="sd">        4. Verify scaling effect</span>

<span class="sd">        Args:</span>
<span class="sd">            load_increase: Factor of load increase</span>
<span class="sd">            component: System component to scale</span>

<span class="sd">        Returns:</span>
<span class="sd">            New worker counts per component</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'collectors'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_collectors</span><span class="p">(),</span>
            <span class="s1">'analyzers'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_analyzers</span><span class="p">(),</span>
            <span class="s1">'processors'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_processors</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-vertical-scaling">2. Vertical Scaling</h3><p>Optimizing resource usage on existing workers:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ResourceOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Optimizes resource usage per worker.</span>

<span class="sd">    Why optimize:</span>
<span class="sd">    - Memory is often the bottleneck</span>
<span class="sd">    - CPU usage varies by task type</span>
<span class="sd">    - Some tasks need more resources</span>

<span class="sd">    Key concepts:</span>
<span class="sd">    1. Memory management</span>
<span class="sd">    2. CPU optimization</span>
<span class="sd">    3. I/O efficiency</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">optimize_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                       <span class="n">worker_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Optimize single worker performance.</span>

<span class="sd">        Steps:</span>
<span class="sd">        1. Analyze current usage</span>
<span class="sd">        2. Identify bottlenecks</span>
<span class="sd">        3. Adjust resources</span>
<span class="sd">        4. Monitor impact</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'memory_config'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_memory</span><span class="p">(),</span>
            <span class="s1">'cpu_config'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_cpu</span><span class="p">(),</span>
            <span class="s1">'io_config'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_io</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="3-data-partitioning">3. Data Partitioning</h3><p>Splitting workload across workers:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">WorkloadManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages workload distribution.</span>

<span class="sd">    Why partition data:</span>
<span class="sd">    - Even load distribution</span>
<span class="sd">    - Parallel processing</span>
<span class="sd">    - Resource optimization</span>

<span class="sd">    Example:</span>
<span class="sd">        manager = WorkloadManager()</span>
<span class="sd">        partitions = manager.partition_workload(tasks)</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">partition_workload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">tasks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Partition tasks across workers.</span>

<span class="sd">        Strategy:</span>
<span class="sd">        1. Group similar tasks</span>
<span class="sd">        2. Balance load</span>
<span class="sd">        3. Consider dependencies</span>
<span class="sd">        4. Optimize resources</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_partition</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
        <span class="p">]</span>
</code></pre></div><h3 id="2-queue-management">2. Queue Management</h3><p>Managing task queues effectively:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">QueueManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages task queues and priorities.</span>

<span class="sd">    Why this matters:</span>
<span class="sd">    - Not all tasks are equally important</span>
<span class="sd">    - Resources are limited</span>
<span class="sd">    - Response time expectations vary</span>

<span class="sd">    For example:</span>
<span class="sd">    - High priority: Client waiting for results</span>
<span class="sd">    - Normal: Regular weekly updates</span>
<span class="sd">    - Background: System maintenance</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">manage_queues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Manage multiple task queues.</span>

<span class="sd">        Strategy:</span>
<span class="sd">        1. Prioritize interactive tasks</span>
<span class="sd">        2. Balance resource usage</span>
<span class="sd">        3. Prevent queue starvation</span>
<span class="sd">        4. Handle overload situations</span>

<span class="sd">        Example:</span>
<span class="sd">            A client requesting immediate results gets</span>
<span class="sd">            priority over background weekly updates</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'queue_status'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_queue_status</span><span class="p">(),</span>
            <span class="s1">'priority_assignments'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_priorities</span><span class="p">(),</span>
            <span class="s1">'resource_allocation'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allocate_resources</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>












<button class="collapsible">Load Balancing</button><div class="content"><h3 id="1-task-distribution">1. Task Distribution</h3><p>Balance tasks across workers:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LoadBalancer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Distributes tasks evenly across workers.</span>

<span class="sd">    Why balance load:</span>
<span class="sd">    - Prevent worker overload</span>
<span class="sd">    - Maximize throughput</span>
<span class="sd">    - Ensure reliability</span>

<span class="sd">    Key features:</span>
<span class="sd">    1. Dynamic allocation</span>
<span class="sd">    2. Priority handling</span>
<span class="sd">    3. Resource awareness</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">distribute_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">tasks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Distribute tasks to workers.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Check worker status</span>
<span class="sd">        2. Assess task requirements</span>
<span class="sd">        3. Match tasks to workers</span>
<span class="sd">        4. Monitor distribution</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'high_priority'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_priority_tasks</span><span class="p">(),</span>
            <span class="s1">'normal'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_normal_tasks</span><span class="p">(),</span>
            <span class="s1">'background'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_background_tasks</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>



<button class="collapsible">Resource Management</button><div class="content"><h3 id="1-memory-scaling">1. Memory Scaling</h3><p>Managing memory across the system:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MemoryManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages system memory allocation.</span>

<span class="sd">    Common challenges:</span>
<span class="sd">    - Large datasets don't fit in memory</span>
<span class="sd">    - LLM processing needs significant memory</span>
<span class="sd">    - Multiple concurrent tasks compete for memory</span>

<span class="sd">    Solution approach:</span>
<span class="sd">    1. Streaming processing for large datasets</span>
<span class="sd">    2. Memory pools for LLM tasks</span>
<span class="sd">    3. Dynamic resource allocation</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">manage_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                          <span class="n">task_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">size_estimate</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Manage memory for specific task.</span>

<span class="sd">        Example scenario:</span>
<span class="sd">        - Task needs 2GB for processing</span>
<span class="sd">        - System has 8GB available</span>
<span class="sd">        - Other tasks need 4GB</span>
<span class="sd">        → Implement streaming if can't allocate 2GB</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">size_estimate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_memory</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_streaming_process</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allocate_memory_pool</span><span class="p">()</span>
</code></pre></div><h3 id="2-database-scaling">2. Database Scaling</h3><p>Scale database operations:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DatabaseScaler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages database scaling strategies.</span>

<span class="sd">    Key concepts:</span>
<span class="sd">    1. Read/Write separation</span>
<span class="sd">    2. Connection pooling</span>
<span class="sd">    3. Query optimization</span>

<span class="sd">    Why important:</span>
<span class="sd">    - Database is often the bottleneck</span>
<span class="sd">    - Concurrent access needs management</span>
<span class="sd">    - Data integrity must be maintained</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">scale_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                      <span class="n">load_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Implement database scaling strategies.</span>

<span class="sd">        Common scenarios:</span>
<span class="sd">        1. Many readers, few writers</span>
<span class="sd">        2. Batch processing needs</span>
<span class="sd">        3. Real-time query requirements</span>

<span class="sd">        Example:</span>
<span class="sd">        - Use read replicas for search queries</span>
<span class="sd">        - Main database for updates only</span>
<span class="sd">        - Connection pools for efficient access</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'read_replicas'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_replicas</span><span class="p">(),</span>
            <span class="s1">'connection_pools'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_pools</span><span class="p">(),</span>
            <span class="s1">'query_routes'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_routing</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Monitoring and Alerts</button><div class="content"><h3 id="1-performance-monitoring">1. Performance Monitoring</h3><p>Track system performance:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PerformanceMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Monitors system performance metrics.</span>

<span class="sd">    What to monitor:</span>
<span class="sd">    1. Processing times</span>
<span class="sd">    2. Queue lengths</span>
<span class="sd">    3. Resource usage</span>
<span class="sd">    4. Error rates</span>

<span class="sd">    Why monitor:</span>
<span class="sd">    - Detect problems early</span>
<span class="sd">    - Plan capacity needs</span>
<span class="sd">    - Optimize resource use</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">monitor_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Collect and analyze performance metrics.</span>

<span class="sd">        Key metrics:</span>
<span class="sd">        - Average processing time per task</span>
<span class="sd">        - Queue wait times</span>
<span class="sd">        - Resource utilization</span>
<span class="sd">        - Error frequency</span>

<span class="sd">        Example threshold:</span>
<span class="sd">        - Alert if processing time &gt; 2x normal</span>
<span class="sd">        - Warning if queue length &gt; 1000</span>
<span class="sd">        - Critical if error rate &gt; 5%</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'processing_metrics'</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_processing_stats</span><span class="p">(),</span>
            <span class="s1">'resource_metrics'</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_resource_stats</span><span class="p">(),</span>
            <span class="s1">'error_metrics'</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_error_stats</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-capacity-planning">2. Capacity Planning</h3><p>Plan for growth:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CapacityPlanner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Plans system capacity needs.</span>

<span class="sd">    Planning factors:</span>
<span class="sd">    1. Current usage trends</span>
<span class="sd">    2. Growth projections</span>
<span class="sd">    3. Performance targets</span>

<span class="sd">    Example:</span>
<span class="sd">    If each client adds 50 queries/week and we</span>
<span class="sd">    expect 10 new clients/month, we need to plan</span>
<span class="sd">    for 500 additional queries per month</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">plan_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                     <span class="n">growth_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                     <span class="n">months_ahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Project future capacity needs.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Analyze current usage</span>
<span class="sd">        2. Project growth</span>
<span class="sd">        3. Plan resources</span>
<span class="sd">        4. Set upgrade triggers</span>

<span class="sd">        Example calculation:</span>
<span class="sd">        Current: 1000 queries/day</span>
<span class="sd">        Growth: 20% monthly</span>
<span class="sd">        3-month need: ~1700 queries/day</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">'resource_projections'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_resources</span><span class="p">(),</span>
            <span class="s1">'scaling_recommendations'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recommendations</span><span class="p">(),</span>
            <span class="s1">'cost_estimates'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_costs</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="metrics.md">Performance Metrics</a></li>
<li><a href="../deployment/resources.md">Resource Management</a></li>
<li><a href="../deployment/monitoring.md">Monitoring Setup</a></li>
<li><a href="../deployment/costs.md">Cost Management</a> </li>
</ul></div>

                </article>
                
            </section>
            
            <section id="troubleshooting">
                <h2>Troubleshooting</h2>
                
                <article id="troubleshooting-common-issues">
                    <h1 id="common-issues">Common Issues</h1>
<button class="collapsible">Overview</button><div class="content"><p>This guide helps analysts resolve common issues in:
- Signal quality
- Analysis accuracy
- Processing efficiency
- Result validation</p></div>

<button class="collapsible">Signal Quality Issues</button><div class="content"><h3 id="1-low-signal-quality">1. Low Signal Quality</h3><p>When LLM returns too many weak signals:</p><div class="codehilite"><pre><span></span><code>Problem:
- Many signals with low strength (1-2)
- Vague or general matches
- Missing important details

Solution:
1. Review and improve prompt specificity:
   - Add more specific signal indicators
   - Include clear exclusion criteria
   - Provide better examples

2. Check search queries:
   - Make keywords more specific
   - Add relevant industry terms
   - Include technical specifications
</code></pre></div><h3 id="2-false-positives">2. False Positives</h3><p>When LLM identifies irrelevant matches:</p><div class="codehilite"><pre><span></span><code>Problem:
- Competitors marked as leads
- News about wrong topics
- Irrelevant company mentions

Solution:
1. Enhance exclusion criteria:
   - List competitor keywords
   - Define clear industry boundaries
   - Specify what's not a signal

2. Improve context understanding:
   - Add industry-specific examples
   - Clarify business relationships
   - Define market positions
</code></pre></div></div>






<button class="collapsible">Analysis Issues</button><div class="content"><h3 id="1-inconsistent-format">1. Inconsistent Format</h3><p>When LLM responses don't follow the format:</p><div class="codehilite"><pre><span></span><code>Problem:
- Missing fields in response
- Wrong data types
- Inconsistent structure

Solution:
1. Strengthen format requirements:
   - Add more format examples
   - Specify required fields
   - Include validation rules

2. Check prompt clarity:
   - Review format instructions
   - Add field descriptions
   - Show good/bad examples
</code></pre></div><h3 id="2-missing-information">2. Missing Information</h3><p>When key details are not extracted:</p><div class="codehilite"><pre><span></span><code>Problem:
- Missing company names
- Incomplete summaries
- Vague context

Solution:
1. Improve data extraction:
   - Specify where to look
   - Add extraction rules
   - Provide fallback options

2. Enhance context requirements:
   - Define minimum info needed
   - Add context examples
   - Specify detail level
</code></pre></div></div>






<button class="collapsible">Processing Issues</button><div class="content"><h3 id="1-token-limits">1. Token Limits</h3><p>When hitting LLM token limits:</p><div class="codehilite"><pre><span></span><code>Problem:
- Truncated responses
- Incomplete analysis
- Processing errors

Solution:
1. Optimize content:
   - Focus on relevant parts
   - Remove redundant text
   - Structure data efficiently

2. Adjust batch size:
   - Split large texts
   - Process in chunks
   - Combine results later
</code></pre></div><h3 id="2-rate-limits">2. Rate Limits</h3><p>When hitting API rate limits:</p><div class="codehilite"><pre><span></span><code>Problem:
- Failed requests
- Processing delays
- Incomplete batches

Solution:
1. Optimize processing:
   - Add request delays
   - Implement retries
   - Use batch processing

2. Manage quotas:
   - Monitor usage
   - Schedule tasks
   - Distribute load
</code></pre></div></div>






<button class="collapsible">Quality Control</button><div class="content"><h3 id="1-validation-process">1. Validation Process</h3><p>Implement quality checks:</p><div class="codehilite"><pre><span></span><code>Problem:
- Missed important signals
- Quality inconsistency
- Validation overhead

Solution:
1. Use validation samples:
   - Mix known good signals
   - Check detection rate
   - Track accuracy

2. Regular reviews:
   - Check random samples
   - Document issues
   - Update prompts
</code></pre></div><h3 id="2-performance-tracking">2. Performance Tracking</h3><p>Monitor analysis quality:</p><div class="codehilite"><pre><span></span><code>Problem:
- Quality degradation
- Inconsistent results
   - Efficiency issues

Solution:
1. Track metrics:
   - Signal quality scores
   - Processing success rate
   - Analysis accuracy

2. Regular optimization:
   - Review performance
   - Update configurations
   - Refine prompts
</code></pre></div></div>






<button class="collapsible">Best Practices</button><div class="content"><h3 id="1-regular-maintenance">1. Regular Maintenance</h3><p>Keep system optimized:</p><ul>
<li>Review and update prompts monthly</li>
<li>Check search queries effectiveness</li>
<li>Monitor signal quality trends</li>
<li>Document successful approaches</li>
</ul><h3 id="2-quality-improvement">2. Quality Improvement</h3><p>Continuously enhance results:</p><ul>
<li>Collect analyst feedback</li>
<li>Document common issues</li>
<li>Share successful solutions</li>
<li>Update best practices</li>
</ul></div>






<button class="collapsible">Related Topics</button><div class="content"><ul>
<li><a href="../business-processes/analysis-process.md">Analysis Process</a></li>
<li><a href="../prompts/structure.md">Prompt Structure</a></li>
<li><a href="../performance/metrics.md">Quality Metrics</a></li>
<li><a href="support.md">Support Guide</a></li>
</ul></div>

                </article>
                
                <article id="troubleshooting-specific-cases">
                    <h1 id="specific-cases">Specific Cases</h1>
<button class="collapsible">Signal Processing Issues</button><div class="content"><h3 id="1-signal-quality-problems">1. Signal Quality Problems</h3><p>Handling specific signal quality issues:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SignalQualityHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Handles specific signal quality issues.</span>

<span class="sd">    Common scenarios:</span>
<span class="sd">    1. Low confidence signals</span>
<span class="sd">    2. Ambiguous classifications</span>
<span class="sd">    3. Incomplete data</span>
<span class="sd">    4. Conflicting signals</span>
<span class="sd">    5. False positives</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="nf">analyze_signal_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Analyze and resolve signal quality issues.</span>

<span class="sd">        Analysis steps:</span>
<span class="sd">        1. Quality metrics calculation</span>
<span class="sd">        2. Issue identification</span>
<span class="sd">        3. Resolution strategies</span>
<span class="sd">        4. Recommendations</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; handler = SignalQualityHandler()</span>
<span class="sd">            &gt;&gt;&gt; result = handler.analyze_signal_quality({</span>
<span class="sd">            ...     'text': 'Company X might be expanding...',</span>
<span class="sd">            ...     'confidence': 0.6,</span>
<span class="sd">            ...     'source': 'news_article'</span>
<span class="sd">            ... })</span>
<span class="sd">            &gt;&gt;&gt; print(result['quality_score'])</span>
<span class="sd">            0.75</span>

<span class="sd">        Args:</span>
<span class="sd">            signal: Signal data to analyze</span>

<span class="sd">        Returns:</span>
<span class="sd">            Quality analysis results</span>
<span class="sd">        """</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"quality_score"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_quality_score</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span>
            <span class="s2">"issues"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">"recommendations"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Check confidence threshold</span>
        <span class="k">if</span> <span class="n">signal</span><span class="p">[</span><span class="s1">'confidence'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">settings</span><span class="o">.</span><span class="n">MIN_CONFIDENCE</span><span class="p">:</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s2">"issues"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"low_confidence"</span><span class="p">,</span>
                <span class="s2">"severity"</span><span class="p">:</span> <span class="s2">"high"</span><span class="p">,</span>
                <span class="s2">"details"</span><span class="p">:</span> <span class="s2">"Signal confidence below threshold"</span><span class="p">,</span>
                <span class="s2">"resolution"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">"Verify source reliability"</span><span class="p">,</span>
                    <span class="s2">"Cross-reference with other sources"</span><span class="p">,</span>
                    <span class="s2">"Apply additional validation rules"</span>
                <span class="p">]</span>
            <span class="p">})</span>

        <span class="c1"># Check data completeness</span>
        <span class="n">missing_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_completeness</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s2">"issues"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"incomplete_data"</span><span class="p">,</span>
                <span class="s2">"severity"</span><span class="p">:</span> <span class="s2">"medium"</span><span class="p">,</span>
                <span class="s2">"details"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Missing fields: </span><span class="si">{</span><span class="n">missing_fields</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
                <span class="s2">"resolution"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">"Implement data enrichment"</span><span class="p">,</span>
                    <span class="s2">"Use fallback data sources"</span><span class="p">,</span>
                    <span class="s2">"Update extraction rules"</span>
                <span class="p">]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">analysis</span>
</code></pre></div><h3 id="2-context-specific-processing">2. Context-Specific Processing</h3><p>Handling industry-specific signal processing:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">IndustrySignalProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Processes signals with industry-specific logic.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Industry-specific validation</span>
<span class="sd">    2. Custom classification rules</span>
<span class="sd">    3. Domain-specific enrichment</span>
<span class="sd">    4. Specialized filtering</span>

<span class="sd">    Example usage:</span>
<span class="sd">        processor = IndustrySignalProcessor('tech')</span>
<span class="sd">        result = await processor.process_signal(signal_data)</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">industry</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize with industry-specific configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            industry: Industry identifier (e.g., 'tech', 'finance')</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">industry</span> <span class="o">=</span> <span class="n">industry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_industry_rules</span><span class="p">(</span><span class="n">industry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_validators</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                           <span class="n">signal</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                           <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Process signal with industry-specific logic.</span>

<span class="sd">        Processing steps:</span>
<span class="sd">        1. Industry validation</span>
<span class="sd">        2. Custom classification</span>
<span class="sd">        3. Domain enrichment</span>
<span class="sd">        4. Quality assessment</span>

<span class="sd">        Args:</span>
<span class="sd">            signal: Signal data to process</span>
<span class="sd">            context: Additional context information</span>

<span class="sd">        Returns:</span>
<span class="sd">            Processed signal with industry-specific analysis</span>
<span class="sd">        """</span>
        <span class="c1"># Validate against industry rules</span>
        <span class="n">validation_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_industry_relevance</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_result</span><span class="p">[</span><span class="s1">'is_valid'</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">'status'</span><span class="p">:</span> <span class="s1">'rejected'</span><span class="p">,</span>
                <span class="s1">'reason'</span><span class="p">:</span> <span class="n">validation_result</span><span class="p">[</span><span class="s1">'reason'</span><span class="p">],</span>
                <span class="s1">'suggestions'</span><span class="p">:</span> <span class="n">validation_result</span><span class="p">[</span><span class="s1">'suggestions'</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Apply industry-specific processing</span>
        <span class="n">processed</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_industry_rules</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="c1"># Enrich with industry context</span>
        <span class="n">enriched</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_with_industry_data</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enriched</span>
</code></pre></div></div>






<button class="collapsible">Integration Edge Cases</button><div class="content"><h3 id="1-api-response-handling">1. API Response Handling</h3><p>Handling unusual API response patterns:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EdgeCaseHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Handles edge cases in API responses.</span>

<span class="sd">    Common edge cases:</span>
<span class="sd">    1. Partial responses</span>
<span class="sd">    2. Malformed data</span>
<span class="sd">    3. Unexpected formats</span>
<span class="sd">    4. Rate limit edge cases</span>
<span class="sd">    5. Timeout scenarios</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">response</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                            <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Process and handle edge cases in API responses.</span>

<span class="sd">        Handling strategy:</span>
<span class="sd">        1. Response validation</span>
<span class="sd">        2. Edge case detection</span>
<span class="sd">        3. Recovery attempts</span>
<span class="sd">        4. Fallback processing</span>

<span class="sd">        Args:</span>
<span class="sd">            response: Raw API response</span>
<span class="sd">            context: Request context</span>

<span class="sd">        Returns:</span>
<span class="sd">            Processed and validated response</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate response structure</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_structure</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_malformed_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

            <span class="c1"># Check for partial data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_partial_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_partial_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="c1"># Process valid response</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_normal_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Edge case encountered: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_fallback_strategy</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></div>



                </article>
                
                <article id="troubleshooting-support">
                    <h1 id="support">Support</h1>
<button class="collapsible">System Monitoring</button><div class="content"><h3 id="1-performance-monitoring">1. Performance Monitoring</h3><p>Setting up comprehensive system monitoring:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SystemMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Monitors system performance and health.</span>

<span class="sd">    Monitoring areas:</span>
<span class="sd">    1. API response times</span>
<span class="sd">    2. Resource utilization</span>
<span class="sd">    3. Error rates</span>
<span class="sd">    4. Queue lengths</span>
<span class="sd">    5. Processing throughput</span>

<span class="sd">    Example usage:</span>
<span class="sd">        monitor = SystemMonitor()</span>
<span class="sd">        await monitor.start_monitoring()</span>
<span class="sd">        metrics = await monitor.get_current_metrics()</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize monitoring system.</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Configuration including:</span>
<span class="sd">                - metrics_interval: Monitoring interval</span>
<span class="sd">                - alert_thresholds: Alert trigger levels</span>
<span class="sd">                - logging_config: Logging settings</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics_collector</span> <span class="o">=</span> <span class="n">MetricsCollector</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alert_manager</span> <span class="o">=</span> <span class="n">AlertManager</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'alert_thresholds'</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dashboard</span> <span class="o">=</span> <span class="n">MonitoringDashboard</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_system_health</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get comprehensive system health status.</span>

<span class="sd">        Checks:</span>
<span class="sd">        1. Service availability</span>
<span class="sd">        2. Resource utilization</span>
<span class="sd">        3. Error rates</span>
<span class="sd">        4. Performance metrics</span>

<span class="sd">        Returns:</span>
<span class="sd">            System health information</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"services"</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_services</span><span class="p">(),</span>
            <span class="s2">"resources"</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_resources</span><span class="p">(),</span>
            <span class="s2">"performance"</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_performance</span><span class="p">(),</span>
            <span class="s2">"errors"</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_error_stats</span><span class="p">(),</span>
            <span class="s2">"recommendations"</span><span class="p">:</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_recommendations</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div><h3 id="2-alert-management">2. Alert Management</h3><p>Implementing alert system for critical issues:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AlertManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages system alerts and notifications.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Alert prioritization</span>
<span class="sd">    2. Notification routing</span>
<span class="sd">    3. Alert aggregation</span>
<span class="sd">    4. Response tracking</span>
<span class="sd">    5. Escalation management</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                         <span class="n">alert</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                         <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Process and route system alerts.</span>

<span class="sd">        Process flow:</span>
<span class="sd">        1. Alert validation</span>
<span class="sd">        2. Priority assessment</span>
<span class="sd">        3. Notification dispatch</span>
<span class="sd">        4. Response tracking</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; await alert_manager.handle_alert({</span>
<span class="sd">            ...     'type': 'api_error',</span>
<span class="sd">            ...     'severity': 'high',</span>
<span class="sd">            ...     'message': 'XMLSTOCK API timeout'</span>
<span class="sd">            ... })</span>

<span class="sd">        Args:</span>
<span class="sd">            alert: Alert information</span>
<span class="sd">            context: Additional context</span>
<span class="sd">        """</span>
        <span class="c1"># Assess priority</span>
        <span class="n">priority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_priority</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>

        <span class="c1"># Route alert</span>
        <span class="k">if</span> <span class="n">priority</span> <span class="o">==</span> <span class="s1">'critical'</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_critical_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">priority</span> <span class="o">==</span> <span class="s1">'high'</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_high_priority</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_normal_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>

        <span class="c1"># Track response</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_track_alert_response</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
</code></pre></div></div>






<button class="collapsible">Maintenance Procedures</button><div class="content"><h3 id="1-system-updates">1. System Updates</h3><p>Managing system updates and maintenance:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MaintenanceManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages system maintenance and updates.</span>

<span class="sd">    Procedures:</span>
<span class="sd">    1. Version updates</span>
<span class="sd">    2. Database maintenance</span>
<span class="sd">    3. Cache cleanup</span>
<span class="sd">    4. Log rotation</span>
<span class="sd">    5. Performance optimization</span>

<span class="sd">    Example usage:</span>
<span class="sd">        manager = MaintenanceManager()</span>
<span class="sd">        await manager.perform_maintenance()</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">perform_maintenance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                <span class="n">maintenance_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'routine'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Execute maintenance procedures.</span>

<span class="sd">        Steps:</span>
<span class="sd">        1. Pre-maintenance checks</span>
<span class="sd">        2. Backup critical data</span>
<span class="sd">        3. Execute maintenance tasks</span>
<span class="sd">        4. Verify system state</span>

<span class="sd">        Args:</span>
<span class="sd">            maintenance_type: Type of maintenance</span>

<span class="sd">        Returns:</span>
<span class="sd">            Maintenance results and status</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Pre-maintenance</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_maintenance</span><span class="p">()</span>

            <span class="c1"># Execute maintenance</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_maintenance_tasks</span><span class="p">(</span><span class="n">maintenance_type</span><span class="p">)</span>

            <span class="c1"># Verify</span>
            <span class="n">verification</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_system_state</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"completed"</span><span class="p">,</span>
                <span class="s2">"results"</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
                <span class="s2">"verification"</span><span class="p">:</span> <span class="n">verification</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_maintenance_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div><h3 id="2-backup-procedures">2. Backup Procedures</h3><p>Implementing data backup and recovery:</p><div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">BackupManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Manages system backups and recovery.</span>

<span class="sd">    Features:</span>
<span class="sd">    1. Automated backups</span>
<span class="sd">    2. Incremental backups</span>
<span class="sd">    3. Recovery procedures</span>
<span class="sd">    4. Backup verification</span>
<span class="sd">    5. Retention management</span>
<span class="sd">    """</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">create_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                          <span class="n">backup_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'full'</span><span class="p">,</span>
                          <span class="n">include_logs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Create system backup.</span>

<span class="sd">        Process:</span>
<span class="sd">        1. Prepare backup</span>
<span class="sd">        2. Execute backup</span>
<span class="sd">        3. Verify backup</span>
<span class="sd">        4. Update backup registry</span>

<span class="sd">        Args:</span>
<span class="sd">            backup_type: Type of backup</span>
<span class="sd">            include_logs: Whether to include logs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Backup information and status</span>
<span class="sd">        """</span>
        <span class="n">backup_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="n">backup_type</span><span class="p">,</span>
            <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
            <span class="s2">"includes_logs"</span><span class="p">:</span> <span class="n">include_logs</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create backup</span>
            <span class="n">backup_path</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_backup</span><span class="p">(</span><span class="n">backup_type</span><span class="p">,</span> <span class="n">include_logs</span><span class="p">)</span>

            <span class="c1"># Verify backup</span>
            <span class="n">verification</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verify_backup</span><span class="p">(</span><span class="n">backup_path</span><span class="p">)</span>

            <span class="c1"># Update registry</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_backup_registry</span><span class="p">(</span><span class="n">backup_info</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"success"</span><span class="p">,</span>
                <span class="s2">"backup_info"</span><span class="p">:</span> <span class="n">backup_info</span><span class="p">,</span>
                <span class="s2">"verification"</span><span class="p">:</span> <span class="n">verification</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Backup failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">BackupError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to create backup: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></div>






                </article>
                
            </section>
            
        </main>

        <aside class="toc">
            <!-- Table of contents will be generated here -->
        </aside>
    </div>

    <script>
        // Скрипт для работы collapsible секций
        var coll = document.getElementsByClassName("collapsible");
        for (var i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        }

        // Подсветка кода
        document.querySelectorAll('pre code').forEach((el) => {
            hljs.highlightElement(el);
        });

        // Генерация оглавления для текущего раздела
        function updateTOC() {
            const main = document.querySelector('main');
            const toc = document.querySelector('.toc');
            const headings = main.querySelectorAll('h2, h3, h4');
            
            const tocList = document.createElement('ul');
            headings.forEach(heading => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.textContent = heading.textContent;
                a.href = `#${heading.id}`;
                li.appendChild(a);
                tocList.appendChild(li);
            });
            
            toc.innerHTML = '';
            toc.appendChild(tocList);
        }

        // Обновляем оглавление при скролле
        window.addEventListener('scroll', updateTOC);
        updateTOC();

        // Обработчики для спойлеров
        document.querySelectorAll('.section-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                content.classList.toggle('active');
            });
        });

        document.querySelectorAll('.file-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                content.classList.toggle('active');
            });
        });
    </script>
</body>
</html>